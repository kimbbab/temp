<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¶„ìˆ˜ ì ìˆ˜ ëŒ€ê²° ê²Œì„</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Noto Sans KR', sans-serif;
        }
        body {
            margin: 0;
            padding: 20px;
            background-color: #f0f9ff;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        h1 {
            text-align: center;
            color: #1a237e;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #455a64;
            margin-top: 0;
            margin-bottom: 20px;
        }
        .game-area {
            background-color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .players-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .player {
            width: 48%;
            padding: 15px;
            text-align: center;
            border-radius: 8px;
            position: relative;
        }
        .player-human {
            background-color: #e3f2fd;
            border: 2px solid #42a5f5;
        }
        .player-computer {
            background-color: #ffebee;
            border: 2px solid #ef5350;
        }
        .player h3 {
            margin-top: 0;
            margin-bottom: 5px;
        }
        .score {
            font-size: 2.5em;
            font-weight: bold;
            margin: 5px 0;
        }
        .score-human {
            color: #0d47a1;
        }
        .score-computer {
            color: #b71c1c;
        }
        .needed {
            font-size: 1em;
            color: #666;
        }
        .current-player-indicator {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #ff9800;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            white-space: nowrap;
        }
        .message {
            padding: 15px;
            background-color: #fff9c4;
            border-left: 4px solid #ffc107;
            margin-bottom: 20px;
            font-size: 1.1em;
        }
        .stopwatch-container {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background-color: #f5f5f5;
            border-radius: 10px;
        }
        .stopwatch {
            font-size: 3.5em;
            font-family: monospace;
            margin-bottom: 15px;
            color: #333;
        }
        .fraction-result {
            font-size: 1.5em;
            margin: 12px 0;
            font-weight: bold;
            color: #0277bd;
        }
        .factorized-fraction {
            font-size: 1.3em;
            margin: 12px 0;
            color: #555;
            font-family: 'Courier New', monospace;
        }
        .btn {
            padding: 10px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            margin: 5px;
            font-weight: bold;
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .btn-primary {
            background-color: #4caf50;
            color: white;
        }
        .btn-primary:hover:not(:disabled) {
            background-color: #388e3c;
            transform: translateY(-2px);
        }
        .btn-danger {
            background-color: #f44336;
            color: white;
        }
        .btn-danger:hover:not(:disabled) {
            background-color: #d32f2f;
            transform: translateY(-2px);
        }
        .btn-secondary {
            background-color: #9e9e9e;
            color: white;
        }
        .btn-secondary:hover:not(:disabled) {
            background-color: #757575;
            transform: translateY(-2px);
        }
        .answer-btn {
            min-width: 130px;
            background-color: #2196f3;
            color: white;
            margin: 8px;
        }
        .answer-btn:hover:not(:disabled) {
            background-color: #1976d2;
            transform: translateY(-2px);
        }
        .answer-options {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 15px 0;
        }
        .hidden {
            display: none;
        }
        .correct {
            background-color: #4caf50 !important;
        }
        .incorrect {
            background-color: #f44336 !important;
        }
        .computer-thinking {
            font-style: italic;
            color: #666;
            margin-top: 15px;
        }
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        .result-table th, .result-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        .result-table th {
            background-color: #f5f5f5;
            color: #333;
        }
        .result-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .history-container {
            margin-top: 20px;
            background-color: #f5f5f5;
            border-radius: 8px;
            padding: 15px;
        }
        .history-title {
            margin-top: 0;
            color: #333;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
            margin-bottom: 10px;
        }
        .history-list {
            max-height: 200px;
            overflow-y: auto;
            padding: 5px;
        }
        .history-item {
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 5px;
        }
        .history-item.player {
            background-color: #e3f2fd;
        }
        .history-item.computer {
            background-color: #ffebee;
        }
        .winner-banner {
            text-align: center;
            margin-top: 20px;
            padding: 20px;
            background-color: #f0f4c3;
            border-radius: 10px;
            font-size: 1.5em;
            font-weight: bold;
            color: #33691e;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ë¶„ìˆ˜ ì ìˆ˜ ëŒ€ê²° ê²Œì„</h1>
        <p class="subtitle">ë¶„ìˆ˜ ìœ í˜•ì„ ë§ì¶”ê³  ì ìˆ˜ë¥¼ ìŒ“ì•„ 30ì ì„ ë¨¼ì € ë‹¬ì„±í•˜ì„¸ìš”!</p>
        
        <div class="game-area">
            <div class="players-container">
                <div class="player player-human">
                    <h3>í”Œë ˆì´ì–´</h3>
                    <div class="score score-human" id="player-score">0</div>
                    <div class="needed" id="player-needed">ìŠ¹ë¦¬ê¹Œì§€ 30ì  í•„ìš”</div>
                    <div class="current-player-indicator hidden" id="player-indicator">ë‚´ ì°¨ë¡€</div>
                </div>
                <div class="player player-computer">
                    <h3>ì»´í“¨í„°</h3>
                    <div class="score score-computer" id="computer-score">0</div>
                    <div class="needed" id="computer-needed">ìŠ¹ë¦¬ê¹Œì§€ 30ì  í•„ìš”</div>
                    <div class="current-player-indicator hidden" id="computer-indicator">ì»´í“¨í„° ì°¨ë¡€</div>
                </div>
            </div>

            <div class="message" id="game-message">
                í”Œë ˆì´ì–´ ì°¨ë¡€ì…ë‹ˆë‹¤. ìŠ¤í†±ì›Œì¹˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”.
            </div>

            <div class="stopwatch-container">
                <div class="stopwatch" id="stopwatch">00:00.00</div>
                <div class="fraction-result" id="fraction-result"></div>
                <div class="factorized-fraction" id="factorized-fraction"></div>
                <div id="move-result"></div>
                
                <div>
                    <button class="btn btn-primary" id="start-btn">ì‹œì‘</button>
                    <button class="btn btn-danger hidden" id="stop-btn">ì •ì§€</button>
                    <button class="btn btn-secondary" id="reset-btn">ìƒˆ ê²Œì„</button>
                </div>
                
                <div id="answer-options" class="answer-options hidden">
                    <button class="btn answer-btn" data-type="0ë˜ëŠ”1">0 ë˜ëŠ” 1</button>
                    <button class="btn answer-btn" data-type="ìˆœí™˜ì†Œìˆ˜">ìˆœí™˜ì†Œìˆ˜</button>
                    <button class="btn answer-btn" data-type="ìœ í•œì†Œìˆ˜">ìœ í•œì†Œìˆ˜</button>
                    <button class="btn answer-btn" data-type="ìì—°ìˆ˜">2 ì´ìƒì˜ ìì—°ìˆ˜</button>
                    <button class="btn answer-btn" data-type="ë¶„ëª¨0">ë¶„ëª¨ê°€ 0</button>
                </div>
                <div id="computer-thinking" class="computer-thinking hidden">
                    ì»´í“¨í„°ê°€ ìƒê°í•˜ê³  ìˆìŠµë‹ˆë‹¤...
                </div>
            </div>

            <table class="result-table">
                <thead>
                    <tr>
                        <th>ë¶„ìˆ˜ ìœ í˜•</th>
                        <th>íšë“ ì ìˆ˜</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>0 ë˜ëŠ” 1</td>
                        <td>1ì </td>
                    </tr>
                    <tr>
                        <td>ìˆœí™˜ì†Œìˆ˜</td>
                        <td>2ì </td>
                    </tr>
                    <tr>
                        <td>ìœ í•œì†Œìˆ˜</td>
                        <td>3ì </td>
                    </tr>
                    <tr>
                        <td>2 ì´ìƒì˜ ìì—°ìˆ˜</td>
                        <td>4ì </td>
                    </tr>
                    <tr>
                        <td>ë¶„ëª¨ê°€ 0ì¸ ê²½ìš°</td>
                        <td>5ì </td>
                    </tr>
                </tbody>
            </table>

            <div class="history-container">
                <h3 class="history-title">ê²Œì„ ê¸°ë¡</h3>
                <div class="history-list" id="history-list">
                    <!-- ê¸°ë¡ì€ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <div class="winner-banner hidden" id="winner-banner">
                ìŠ¹ë¦¬ì!
            </div>
        </div>
    </div>

    <script>
        // DOM ìš”ì†Œ ì°¸ì¡°
        const stopwatchDisplay = document.getElementById('stopwatch');
        const startBtn = document.getElementById('start-btn');
        const stopBtn = document.getElementById('stop-btn');
        const resetBtn = document.getElementById('reset-btn');
        const fractionResultDisplay = document.getElementById('fraction-result');
        const factorizedFractionDisplay = document.getElementById('factorized-fraction');
        const moveResultDisplay = document.getElementById('move-result');
        const gameMessageDisplay = document.getElementById('game-message');
        const playerScoreDisplay = document.getElementById('player-score');
        const computerScoreDisplay = document.getElementById('computer-score');
        const playerNeededDisplay = document.getElementById('player-needed');
        const computerNeededDisplay = document.getElementById('computer-needed');
        const playerIndicator = document.getElementById('player-indicator');
        const computerIndicator = document.getElementById('computer-indicator');
        const answerOptions = document.getElementById('answer-options');
        const computerThinking = document.getElementById('computer-thinking');
        const answerButtons = document.querySelectorAll('.answer-btn');
        const historyList = document.getElementById('history-list');
        const winnerBanner = document.getElementById('winner-banner');

        // ê²Œì„ ìƒíƒœ ë³€ìˆ˜
        let isRunning = false;
        let startTime = 0;
        let elapsedTime = 0;
        let timerInterval = null;
        let currentPlayer = 'player'; // 'player' ë˜ëŠ” 'computer'
        let pointsToAdd = 0;
        let gameOver = false;
        let correctAnswer = ''; // í˜„ì¬ ë¶„ìˆ˜ ìœ í˜•ì˜ ì •ë‹µ
        let isComputerThinking = false; // ì»´í“¨í„° ìƒê° ì¤‘ í”Œë˜ê·¸
        let computerTurnTimeout = null; // ì»´í“¨í„° í„´ íƒ€ì„ì•„ì›ƒ ID
        
        // ì ìˆ˜ ì •ë³´
        const scores = {
            player: 0,
            computer: 0
        };
        
        // ì ìˆ˜ ê´€ë ¨ ìƒìˆ˜
        const TARGET_SCORE = 30; // ìŠ¹ë¦¬ ì¡°ê±´ ì ìˆ˜
        const POINTS = {
            '0ë˜ëŠ”1': 1,
            'ìˆœí™˜ì†Œìˆ˜': 2,
            'ìœ í•œì†Œìˆ˜': 3,
            'ìì—°ìˆ˜': 4,
            'ë¶„ëª¨0': 5
        };

        // ìŠ¤í†±ì›Œì¹˜ í¬ë§·íŒ…
        function formatTime(time) {
            const minutes = Math.floor(time / 60000);
            const seconds = Math.floor((time % 60000) / 1000);
            const milliseconds = Math.floor((time % 1000) / 10);
            
            return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}.${milliseconds.toString().padStart(2, '0')}`;
        }
        
        // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateButtonState() {
            // í˜„ì¬ ìƒíƒœì— ë”°ë¼ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
            const isPlayerTurn = currentPlayer === 'player';
            const isComputerActive = currentPlayer === 'computer' || isComputerThinking;
            
            startBtn.disabled = isRunning || gameOver || isComputerActive;
            stopBtn.disabled = !isRunning || gameOver || isComputerActive;
            resetBtn.disabled = isComputerThinking;
            
            // ë‹µë³€ ë²„íŠ¼ ìƒíƒœ
            answerButtons.forEach(btn => {
                btn.disabled = isComputerActive || gameOver;
            });
            
            // í˜„ì¬ í”Œë ˆì´ì–´ í‘œì‹œ
            playerIndicator.classList.toggle('hidden', !isPlayerTurn || gameOver);
            computerIndicator.classList.toggle('hidden', !(currentPlayer === 'computer') || gameOver);
        }
        
        // ì ìˆ˜ ì—…ë°ì´íŠ¸
        function updateScores() {
            playerScoreDisplay.textContent = scores.player;
            computerScoreDisplay.textContent = scores.computer;
            
            const playerNeeded = Math.max(0, TARGET_SCORE - scores.player);
            const computerNeeded = Math.max(0, TARGET_SCORE - scores.computer);
            
            playerNeededDisplay.textContent = playerNeeded > 0 ? 
                `ìŠ¹ë¦¬ê¹Œì§€ ${playerNeeded}ì  í•„ìš”` : 'ìŠ¹ë¦¬ ë‹¬ì„±!';
            computerNeededDisplay.textContent = computerNeeded > 0 ? 
                `ìŠ¹ë¦¬ê¹Œì§€ ${computerNeeded}ì  í•„ìš”` : 'ìŠ¹ë¦¬ ë‹¬ì„±!';
        }
        
        // ê¸°ë¡ ì¶”ê°€
        function addHistory(player, fractionStr, answerType, points, correct) {
            const historyItem = document.createElement('div');
            historyItem.className = `history-item ${player}`;
            
            const playerText = player === 'player' ? 'í”Œë ˆì´ì–´' : 'ì»´í“¨í„°';
            const resultText = correct ? 'ì •ë‹µ' : 'ì˜¤ë‹µ';
            const pointsText = correct ? `+${points}ì ` : '+0ì ';
            
            historyItem.innerHTML = `
                <strong>${playerText}:</strong> ${fractionStr} â†’ ${answerType} (${resultText}, ${pointsText})
            `;
            
            historyList.insertBefore(historyItem, historyList.firstChild);
        }
        
        // ìŠ¹ì í™•ì¸
        function checkWinner() {
            if (scores.player >= TARGET_SCORE) {
                gameOver = true;
                winnerBanner.textContent = 'í”Œë ˆì´ì–´ ìŠ¹ë¦¬! ğŸ‰';
                winnerBanner.classList.remove('hidden');
                gameMessageDisplay.textContent = 'ê²Œì„ ì¢…ë£Œ! í”Œë ˆì´ì–´ê°€ ìŠ¹ë¦¬í–ˆìŠµë‹ˆë‹¤!';
                return true;
            } else if (scores.computer >= TARGET_SCORE) {
                gameOver = true;
                winnerBanner.textContent = 'ì»´í“¨í„° ìŠ¹ë¦¬! ğŸ¤–';
                winnerBanner.classList.remove('hidden');
                gameMessageDisplay.textContent = 'ê²Œì„ ì¢…ë£Œ! ì»´í“¨í„°ê°€ ìŠ¹ë¦¬í–ˆìŠµë‹ˆë‹¤!';
                return true;
            }
            return false;
        }
        
        // ìŠ¤í†±ì›Œì¹˜ ì‹œì‘
        function startStopwatch() {
            if (isRunning || gameOver || isComputerThinking) return;
            
            isRunning = true;
            startBtn.classList.add('hidden');
            stopBtn.classList.remove('hidden');
            startTime = Date.now() - elapsedTime;
            timerInterval = setInterval(updateTime, 10);
            gameMessageDisplay.textContent = 'ìŠ¤í†±ì›Œì¹˜ê°€ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤. ì •ì§€ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.';
            
            // ê²°ê³¼ ì´ˆê¸°í™”
            fractionResultDisplay.textContent = '';
            factorizedFractionDisplay.textContent = '';
            moveResultDisplay.textContent = '';
            answerOptions.classList.add('hidden');
            
            updateButtonState();
        }
        
        // ìŠ¤í†±ì›Œì¹˜ ì •ì§€
        function stopStopwatch() {
            if (!isRunning || gameOver || isComputerThinking) return;
            
            isRunning = false;
            startBtn.classList.remove('hidden');
            stopBtn.classList.add('hidden');
            clearInterval(timerInterval);
            
            // ê²°ê³¼ ê³„ì‚°
            calculateResult();
            
            // í”Œë ˆì´ì–´ í„´ì¼ ë•Œ ë‹µë³€ ì˜µì…˜ í‘œì‹œ
            if (currentPlayer === 'player') {
                answerOptions.classList.remove('hidden');
                gameMessageDisplay.textContent = 'ë¶„ìˆ˜ ìœ í˜•ì„ ë§ì¶°ë³´ì„¸ìš”!';
            } else {
                // ì»´í“¨í„° í„´ì¼ ë•Œ
                isComputerThinking = true;
                computerThinking.classList.remove('hidden');
                gameMessageDisplay.textContent = 'ì»´í“¨í„°ê°€ ë¶„ìˆ˜ ìœ í˜•ì„ ë§ì¶°ì•¼ í•©ë‹ˆë‹¤...';
                
                // ì»´í“¨í„°ê°€ ë‹µë³€ ì„ íƒí•  ìˆ˜ ìˆë„ë¡ ë²„íŠ¼ ë³´ì—¬ì£¼ê¸°
            setTimeout(() => {
                // ì •ë‹µ ë²„íŠ¼ ëª¨ë‘ ë¹„í™œì„±í™” (ì»´í“¨í„° ì°¨ë¡€ë¼ì„œ)
                answerButtons.forEach(btn => {
                    btn.disabled = true;
                });
                answerOptions.classList.remove('hidden');
                
                // 2ì´ˆ í›„ ì»´í“¨í„°ê°€ ë‹µë³€ ì„ íƒ
                setTimeout(() => {
                    computerGuess();
                }, 2000);
            }, 1000);
            }
            
            updateButtonState();
        }
        
        // ìŠ¤í†±ì›Œì¹˜ ì‹œê°„ ì—…ë°ì´íŠ¸
        function updateTime() {
            elapsedTime = Date.now() - startTime;
            stopwatchDisplay.textContent = formatTime(elapsedTime);
        }
        
        // ê²Œì„ ì´ˆê¸°í™” (ìƒˆ ê²Œì„)
        function resetGame() {
            if (isComputerThinking) return;
            
            // ì»´í“¨í„° í„´ íƒ€ì„ì•„ì›ƒ ìˆìœ¼ë©´ ì·¨ì†Œ
            if (computerTurnTimeout) {
                clearTimeout(computerTurnTimeout);
                computerTurnTimeout = null;
            }
            
            clearInterval(timerInterval);
            isRunning = false;
            isComputerThinking = false;
            elapsedTime = 0;
            stopwatchDisplay.textContent = '00:00.00';
            startBtn.classList.remove('hidden');
            stopBtn.classList.add('hidden');
            
            fractionResultDisplay.textContent = '';
            factorizedFractionDisplay.textContent = '';
            moveResultDisplay.textContent = '';
            pointsToAdd = 0;
            currentPlayer = 'player';
            
            answerOptions.classList.add('hidden');
            computerThinking.classList.add('hidden');
            winnerBanner.classList.add('hidden');
            
            // ì •ë‹µ ë²„íŠ¼ë“¤ ë¦¬ì…‹
            answerButtons.forEach(btn => {
                btn.classList.remove('correct', 'incorrect');
            });
            
            gameMessageDisplay.textContent = `ìƒˆ ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤. í”Œë ˆì´ì–´ ì°¨ë¡€ì…ë‹ˆë‹¤. ìŠ¤í†±ì›Œì¹˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”.`;
            
            // ì ìˆ˜ ì´ˆê¸°í™”
            scores.player = 0;
            scores.computer = 0;
            updateScores();
            
            // ê¸°ë¡ ì´ˆê¸°í™”
            historyList.innerHTML = '';
            
            gameOver = false;
            updateButtonState();
        }
        
        // ì†Œì¸ìˆ˜ë¶„í•´ í•¨ìˆ˜
        function getPrimeFactors(num) {
            if (num === 0) return "0";
            if (num === 1) return "1";
            
            const factors = [];
            let divisor = 2;
            
            while (num >= 2) {
                if (num % divisor === 0) {
                    let count = 0;
                    while (num % divisor === 0) {
                        num = num / divisor;
                        count++;
                    }
                    if (count === 1) {
                        factors.push(divisor.toString());
                    } else {
                        factors.push(`${divisor}^${count}`);
                    }
                }
                divisor++;
                
                // ìµœì í™”: ë‚¨ì€ ìˆ«ìê°€ ì†Œìˆ˜ì¼ ê²½ìš°
                if (divisor * divisor > num && num > 1) {
                    factors.push(num.toString());
                    break;
                }
            }
            
            return factors.length ? factors.join(" Ã— ") : "1";  // ë¹ˆ ë°°ì—´ì¸ ê²½ìš° 1 ë°˜í™˜
        }
        
        // ì†Œìˆ˜ê°€ ìˆœí™˜ì†Œìˆ˜ì¸ì§€ í™•ì¸
        function isRecurringDecimal(numerator, denominator) {
            if (denominator === 0) return false;
            
            // ìœ í•œì†Œìˆ˜ê°€ ì•„ë‹ˆë©´ ìˆœí™˜ì†Œìˆ˜
            return !isFiniteDecimal(numerator, denominator);
        }
        
        // ìµœëŒ€ê³µì•½ìˆ˜ ê³„ì‚° (ê¸°ì•½ë¶„ìˆ˜ë¥¼ ìœ„í•´)
        function gcd(a, b) {
            if (b === 0) return a;
            return gcd(b, a % b);
        }
        
        // ì†Œìˆ˜ê°€ ìœ í•œì†Œìˆ˜ì¸ì§€ í™•ì¸
        function isFiniteDecimal(numerator, denominator) {
            if (denominator === 0) return false;
            
            // ê¸°ì•½ë¶„ìˆ˜ë¡œ ë§Œë“¤ê¸°
            const divisor = gcd(Math.abs(numerator), Math.abs(denominator));
            let simplifiedDenominator = Math.abs(denominator) / divisor;
            
            // ë¶„ëª¨ì˜ ì†Œì¸ìˆ˜ê°€ 2ì™€ 5ë§Œ ìˆìœ¼ë©´ ìœ í•œì†Œìˆ˜
            while (simplifiedDenominator % 2 === 0) simplifiedDenominator /= 2;
            while (simplifiedDenominator % 5 === 0) simplifiedDenominator /= 5;
            
            return simplifiedDenominator === 1;
        }
        
        // ê²°ê³¼ ê³„ì‚°
        function calculateResult() {
            // ì´ˆì™€ ë°€ë¦¬ì´ˆ ì¶”ì¶œ
            const timeStr = stopwatchDisplay.textContent.split(':')[1];
            const seconds = parseInt(timeStr.split('.')[0]);
            const milliseconds = parseInt(timeStr.split('.')[1]);
            
            // ë¶„ìˆ˜ í‘œì‹œ
            const fractionStr = `${seconds}/${milliseconds}`;
            fractionResultDisplay.textContent = `ë¶„ìˆ˜: ${fractionStr}`;
            
            // ì†Œì¸ìˆ˜ë¶„í•´ í‘œì‹œ
            const numeratorFactors = getPrimeFactors(seconds);
            const denominatorFactors = getPrimeFactors(milliseconds);
            
            // ì†Œì¸ìˆ˜ë¶„í•´ ê²°ê³¼ í‘œì‹œ
            factorizedFractionDisplay.textContent = 
                `ì†Œì¸ìˆ˜ë¶„í•´: ${numeratorFactors} / ${denominatorFactors === "0" ? "0" : "{" + denominatorFactors + "}"}`;
            
            // ë¶„ìˆ˜ ìœ í˜• ê²°ì • (ì •ë‹µ íŒë³„)
            if (milliseconds === 0) {
                correctAnswer = 'ë¶„ëª¨0';
                pointsToAdd = POINTS['ë¶„ëª¨0'];
            } else if (seconds === 0 || seconds === 1) {
                correctAnswer = '0ë˜ëŠ”1';
                pointsToAdd = POINTS['0ë˜ëŠ”1'];
            } else if (seconds >= 2) {
                correctAnswer = 'ìì—°ìˆ˜';
                pointsToAdd = POINTS['ìì—°ìˆ˜'];
            } else if (isFiniteDecimal(seconds, milliseconds)) {
                correctAnswer = 'ìœ í•œì†Œìˆ˜';
                pointsToAdd = POINTS['ìœ í•œì†Œìˆ˜'];
            } else if (isRecurringDecimal(seconds, milliseconds)) {
                correctAnswer = 'ìˆœí™˜ì†Œìˆ˜';
                pointsToAdd = POINTS['ìˆœí™˜ì†Œìˆ˜'];
            }
        }
        
        // í”Œë ˆì´ì–´ ë‹µë³€ ì²˜ë¦¬
        function handlePlayerAnswer(selectedType) {
            // ì´ë¯¸ ë‹µë³€í–ˆê±°ë‚˜ ê²Œì„ì´ ëë‚¬ìœ¼ë©´ ë¬´ì‹œ
            if (gameOver || isComputerThinking) return;
            
            let correctSelected = false;
            let earnedPoints = 0;
            const fractionStr = fractionResultDisplay.textContent.replace('ë¶„ìˆ˜: ', '');
            
            // ì„ íƒí•œ ë²„íŠ¼ í•˜ì´ë¼ì´íŠ¸
            answerButtons.forEach(btn => {
                if (btn.dataset.type === selectedType) {
                    if (selectedType === correctAnswer) {
                        btn.classList.add('correct');
                        earnedPoints = POINTS[selectedType];
                        correctSelected = true;
                        
                        gameMessageDisplay.textContent = `ì •ë‹µì…ë‹ˆë‹¤! ${earnedPoints}ì ì„ íšë“í–ˆìŠµë‹ˆë‹¤.`;
                        scores.player += earnedPoints;
                    } else {
                        btn.classList.add('incorrect');
                        
                        // ì˜¤ë‹µì¼ ê²½ìš° ì •ë‹µ í‘œì‹œ
                        answerButtons.forEach(correctBtn => {
                            if (correctBtn.dataset.type === correctAnswer) {
                                correctBtn.classList.add('correct');
                            }
                        });
                        
                        gameMessageDisplay.textContent = `í‹€ë ¸ìŠµë‹ˆë‹¤! ì •ë‹µì€ ${correctAnswer}ì…ë‹ˆë‹¤. ì ìˆ˜ë¥¼ íšë“í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.`;
                    }
                }
            });
            
            // ê¸°ë¡ ì¶”ê°€
            addHistory('player', fractionStr, selectedType, earnedPoints, correctSelected);
            
            // ì ìˆ˜ ì—…ë°ì´íŠ¸
            updateScores();
            
            // ìŠ¹ì í™•ì¸
            if (checkWinner()) {
                updateButtonState();
                return;
            }
            
            // ë‹¤ìŒ í„´ ì¤€ë¹„
            setTimeout(() => {
                // ë‹µë³€ ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
                answerButtons.forEach(btn => {
                    btn.classList.remove('correct', 'incorrect');
                });
                
                // ê²°ê³¼ ì´ˆê¸°í™”
                fractionResultDisplay.textContent = '';
                factorizedFractionDisplay.textContent = '';
                moveResultDisplay.textContent = '';
                answerOptions.classList.add('hidden');
                
                // í„´ ë„˜ê¹€
                nextTurn();
            }, 2000);
        }
        
        // ì»´í“¨í„° ë‹µë³€ ì²˜ë¦¬
        function computerGuess() {
            computerThinking.classList.add('hidden');
            
            // 90% í™•ë¥ ë¡œ ì •ë‹µ, 10% í™•ë¥ ë¡œ ì˜¤ë‹µ
            const isCorrect = Math.random() < 0.9;
            let earnedPoints = 0;
            const fractionStr = fractionResultDisplay.textContent.replace('ë¶„ìˆ˜: ', '');
            
            let guessedType = '';
            
            if (isCorrect) {
                guessedType = correctAnswer;
                earnedPoints = POINTS[guessedType];
                scores.computer += earnedPoints;
                
                gameMessageDisplay.textContent = `ì»´í“¨í„°ê°€ ì •ë‹µ(${guessedType})ì„ ë§ì·„ìŠµë‹ˆë‹¤! ${earnedPoints}ì ì„ íšë“í–ˆìŠµë‹ˆë‹¤.`;
            } else {
                // ì˜¤ë‹µ - í‹€ë¦° ë‹µë³€ ì„ íƒ
                const options = ['0ë˜ëŠ”1', 'ìˆœí™˜ì†Œìˆ˜', 'ìœ í•œì†Œìˆ˜', 'ìì—°ìˆ˜', 'ë¶„ëª¨0'].filter(type => type !== correctAnswer);
                guessedType = options[Math.floor(Math.random() * options.length)];
                
                gameMessageDisplay.textContent = `ì»´í“¨í„°ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤! ì»´í“¨í„° ë‹µë³€: ${guessedType}, ì •ë‹µì€ ${correctAnswer}ì…ë‹ˆë‹¤.`;
            }
            
            moveResultDisplay.textContent = `ì»´í“¨í„° ë‹µë³€: ${guessedType}`;
            
            // ê¸°ë¡ ì¶”ê°€
            addHistory('computer', fractionStr, guessedType, earnedPoints, isCorrect);
            
            // ì ìˆ˜ ì—…ë°ì´íŠ¸
            updateScores();
            
            // ìŠ¹ì í™•ì¸
            if (checkWinner()) {
                isComputerThinking = false;
                updateButtonState();
                return;
            }
            
            // ë‹¤ìŒ í„´ ì¤€ë¹„
            setTimeout(() => {
                isComputerThinking = false;
                
                // ê²°ê³¼ ì´ˆê¸°í™”
                fractionResultDisplay.textContent = '';
                factorizedFractionDisplay.textContent = '';
                moveResultDisplay.textContent = '';
                
                // í„´ ë„˜ê¹€
                nextTurn();
            }, 2000);
        }
        
        // ë‹¤ìŒ í„´ìœ¼ë¡œ ì´ë™
        function nextTurn() {
            // ì»´í“¨í„° í„´ íƒ€ì„ì•„ì›ƒ ìˆìœ¼ë©´ ì·¨ì†Œ
            if (computerTurnTimeout) {
                clearTimeout(computerTurnTimeout);
                computerTurnTimeout = null;
            }
            
            // í„´ ë³€ê²½
            currentPlayer = currentPlayer === 'player' ? 'computer' : 'player';
            
            gameMessageDisplay.textContent = `${currentPlayer === 'player' ? 'í”Œë ˆì´ì–´' : 'ì»´í“¨í„°'} ì°¨ë¡€ì…ë‹ˆë‹¤. ${currentPlayer === 'player' ? 'ìŠ¤í†±ì›Œì¹˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”.' : ''}`;
            
            // ì»´í“¨í„° í„´ì´ë©´ ìë™ìœ¼ë¡œ ì‹œì‘
            if (currentPlayer === 'computer' && !gameOver) {
                startComputerTurn();
            } else {
                updateButtonState();
            }
        }
        
        // ì»´í“¨í„° í„´ ì‹œì‘
        function startComputerTurn() {
            isComputerThinking = true;
            updateButtonState();
            
            // ì¢€ ë” ê¸¸ê²Œ ë”œë ˆì´ë¥¼ ì£¼ì–´ í™•ì‹¤íˆ ìˆœì„œë¥¼ ì¸ì‹í•˜ê²Œ í•¨
            computerTurnTimeout = setTimeout(() => {
                startStopwatch(); // ìŠ¤í†±ì›Œì¹˜ ì‹œì‘
                
                // ëœë¤ ì‹œê°„ í›„ ì •ì§€ (ë” ê¸´ ë²”ìœ„)
                const randomDelay = 1000 + Math.random() * 2000;
                computerTurnTimeout = setTimeout(() => {
                    stopStopwatch(); // ìŠ¤í†±ì›Œì¹˜ ì •ì§€
                }, randomDelay);
            }, 1500);
        }
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        startBtn.addEventListener('click', startStopwatch);
        stopBtn.addEventListener('click', stopStopwatch);
        resetBtn.addEventListener('click', resetGame);
        
        // ë‹µë³€ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        answerButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                handlePlayerAnswer(btn.dataset.type);
            });
        });
        
        // ì´ˆê¸°í™”
        updateScores();
        updateButtonState();
    </script>
</body>
</html>