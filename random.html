<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í™•ë¥  ì˜ì‚¬ê²°ì • ê²Œì„</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
            color: #333;
        }
        .game-container {
            max-width: 600px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .game-screen {
            display: none;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .game-screen.active {
            display: block;
        }
        .screen-title {
            font-size: 1.5em;
            color: #007bff;
            margin-bottom: 5px;
        }
        .location {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 15px;
        }
        .situation, .dilemma {
            margin-bottom: 15px;
            line-height: 1.6;
        }
        .choices button, .feedback-actions button {
            display: inline-block; 
            width: auto; 
            padding: 10px 15px; 
            margin: 5px; 
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }
        .choices button.full-width { 
            display: block;
            width: 100%;
        }
        .choices button:hover, .feedback-actions button:hover {
            background-color: #0056b3;
        }
        .choices button:disabled, .feedback-actions button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .player-thought {
            font-style: italic;
            color: #555;
            margin-top: 10px;
            padding: 8px;
            background-color: #e9e9e9;
            border-radius: 3px;
        }
        .immediate-feedback {
            margin-top: 20px;
            padding: 10px;
            background-color: #f9f9f9;
            border: 1px solid #eee;
            border-left: 3px solid #007bff;
            border-radius: 3px;
        }
        .immediate-feedback h4 {
            margin-top: 0;
            color: #0056b3;
        }
        .next-button { 
            display: none; 
            margin-top: 15px;
            padding: 10px 20px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .next-button:hover {
            background-color: #218838;
        }
        #endingScreen .ending-text {
            margin-top: 20px;
            padding: 15px;
            background-color: #e8f5e9;
            border-left: 5px solid #4caf50;
        }
        .highlight {
            font-weight: bold;
            color: #d9534f;
        }
    </style>
</head>
<body>

<div class="game-container">
    <h1>ë‚˜ì˜ ì„ íƒì€?</h1>

    <div id="screen1" class="game-screen active">
        <h2 class="screen-title">ì„ íƒ 1: ì•„ì¹¨, ìš°ì‚°ê³¼ì˜ ëˆˆì¹˜ ì‹¸ì›€</h2>
        <p class="location">ğŸ“ ì¥ì†Œ: ì•„ì¹¨, í˜„ê´€ ì•</p>
        <p class="situation">
            TVì—ì„œ ì•„ë‚˜ìš´ì„œì˜ ëª©ì†Œë¦¬ê°€ í˜ëŸ¬ë‚˜ì˜¨ë‹¤.<br>
            "ì˜¤ëŠ˜ ì „êµ­ì ìœ¼ë¡œ ë¹„ ì†Œì‹ì´ ìˆìŠµë‹ˆë‹¤. í˜„ì¬ ì˜ˆìƒ ê°•ìˆ˜ í™•ë¥ ì€ <span id="rainChance" class="highlight">[xx]</span>%ì…ë‹ˆë‹¤."<br>
            ì°½ë°–ì„ ë³´ë‹ˆ í•˜ëŠ˜ì€ ì•„ì§ íë¦¬ê¸°ë§Œ í•˜ë‹¤.
        </p>
        <p class="dilemma">ğŸ¤” ë‹¹ì‹ ì˜ ê³ ë¯¼: ìš°ì‚°ì„ ê°€ì ¸ê°ˆê¹Œ, ë§ê¹Œ?</p>
        <div class="choices">
            <button class="full-width" id="s1c1" onclick="handleChoice('screen1', 'A')">A) í˜¹ì‹œ ëª¨ë¥´ë‹ˆ, ì±™ê²¨ ë‚˜ê°„ë‹¤.</button>
            <button class="full-width" id="s1c2" onclick="handleChoice('screen1', 'B')">B) ì´ ì •ë„ í™•ë¥ ì´ë©´ ê´œì°®ì•„, ê·¸ëƒ¥ ë‚˜ê°„ë‹¤.</button>
        </div>
        <div class="immediate-feedback" id="feedback1"></div>
        <button class="next-button" id="nextBtn1" onclick="proceedToNext(1)">ë‹¤ìŒìœ¼ë¡œ</button>
    </div>

    <div id="screen2" class="game-screen">
        <h2 class="screen-title">ì„ íƒ 2: ê¸¸ê°€ì˜ ìœ í˜¹, 10%ì˜ ë„ì „</h2>
        <p class="location">ğŸ“ ì¥ì†Œ: ë“±êµ£ê¸¸, ë¬¸êµ¬ì  ì•</p>
        <p class="situation">
            ë“±êµ£ê¸¸, ë¬¸êµ¬ì  ì•ì— ë†“ì¸ ìƒí’ˆ ë½‘ê¸° ê¸°ê³„ê°€ ì‹œì„ ì„ ì‚¬ë¡œì¡ëŠ”ë‹¤.<br>
            "âœ¨ì¸ê¸° ìºë¦­í„° í•œì •íŒ ì¸í˜• íšë“ ì°¬ìŠ¤!âœ¨ ë‹¨ëˆ 100ì›! ì„±ê³µ í™•ë¥  <span class="highlight">10%</span>!"<br>
            (í˜„ì¬ ë‚´ ì§€ê°‘ì—ëŠ” <span id="currentMoneyLottery" class="highlight">[í˜„ì¬ ì†Œì§€ê¸ˆ]</span>ì›ì´ ìˆë‹¤.)
        </p>
        <p class="dilemma">ğŸ¤” ë‹¹ì‹ ì˜ ê³ ë¯¼: 10%ì˜ í™•ë¥ ... í•œë²ˆ ë„ì „í•´ ë³¼ê¹Œ?</p>
        <div class="player-thought">"10%ë©´... ì—´ ë²ˆ ì¤‘ í•œ ë²ˆì€ ë˜ì§€ ì•Šì„ê¹Œ?" (ë‚´ì  ê³ ë¯¼)</div>
        <div class="choices" id="choices2_initial">
            <button class="full-width" id="s2c1_initial" onclick="handleLotteryChoice('initial_try')">A) ì¢‹ì•„, 10%ì˜ í–‰ìš´ì— ë„ì „í•œë‹¤! (100ì› ì°¨ê°)</button>
            <button class="full-width" id="s2c2_initial" onclick="handleLotteryChoice('initial_pass')">B) ìœ¼ìŒ... ê·¸ë˜ë„ ì‹¤íŒ¨í•  ê²ƒ ê°™ì•„. ê·¸ëƒ¥ ì§€ë‚˜ê°€ì.</button>
        </div>
        <div class="immediate-feedback" id="feedback2">
            </div>
        <button class="next-button" id="nextBtn2" onclick="proceedToNext(2)" style="display:none;">ë‹¤ìŒ í™”ë©´ìœ¼ë¡œ</button>
    </div>

    <div id="screen3" class="game-screen">
        <h2 class="screen-title">ì„ íƒ 3: ì§€ê° ìœ„ê¸°! ì •ë¬¸ vs í›„ë¬¸</h2>
        <p class="location">ğŸ“ ì¥ì†Œ: ì•„ìŠ¬ì•„ìŠ¬ ë“±êµ£ê¸¸, í•™êµ ì•</p>
        <p class="situation">
            ì´ëŸ°, ëŠ¦ì ì´ë‹¤! í—ˆê²ì§€ê² í•™êµ ì•ì— ë„ì°©í•˜ë‹ˆ ì´ë¯¸ ìˆ˜ì—… ì‹œì‘ ì¢…ì´ ìš¸ë¦° ê²ƒ ê°™ë‹¤.<br>
            ì •ë¬¸ìœ¼ë¡œ ë‹¹ë‹¹íˆ ë“¤ì–´ê°ˆê¹Œ, ì•„ë‹ˆë©´ í›„ë¬¸ìœ¼ë¡œ ëª°ë˜ ë“¤ì–´ê°ˆê¹Œ?<br>
            ì˜¤ëŠ˜ì€ ìœ ë‚œíˆ ì„ ìƒë‹˜ë“¤ì´ ì§€ê°ìƒì„ ì¡ì„ ê²ƒ ê°™ì€ ë¶ˆê¸¸í•œ ì˜ˆê°ì´ ìŠ¤ì¹œë‹¤.<br>
            (êµì¥ ì„ ìƒë‹˜ì˜ íŠ¹ë³„ ì§€ì‹œë¡œ, ì˜¤ëŠ˜ ì •ë¬¸ê³¼ í›„ë¬¸ ì¤‘ <span class="highlight">í•œ ê³³ì—ì„œë§Œ</span> ì„ ìƒë‹˜ì´ ì§€ê° ë‹¨ì†ì„ í•˜ì‹ ë‹¤!)
        </p>
        <p class="dilemma">ğŸ¤” ë‹¹ì‹ ì˜ ê³ ë¯¼: ì–´ëŠ ë¬¸ìœ¼ë¡œ ë“¤ì–´ê°€ì•¼ ë¬´ì‚¬í• ê¹Œ? ë‚˜ì˜ ì„ íƒì€?</p>
        <div class="choices">
            <button class="full-width" id="s3c1" onclick="handleChoice('screen3', 'A')">A) ì •ë©´ ëŒíŒŒ! ì •ë¬¸ìœ¼ë¡œ ê°€ì!</button>
            <button class="full-width" id="s3c2" onclick="handleChoice('screen3', 'B')">B) ì€ë°€í•˜ê²Œ... í›„ë¬¸ìœ¼ë¡œ ê°€ì.</button>
        </div>
        <div class="immediate-feedback" id="feedback3"></div>
        <button class="next-button" id="nextBtn3" onclick="proceedToNext(3)">ë‹¤ìŒìœ¼ë¡œ</button>
    </div>

    <div id="screen4" class="game-screen">
        <h2 class="screen-title">ì„ íƒ 4: ì‹œí—˜ ì‹œê°„, ë§ˆì§€ë§‰ í•œ ë¬¸ì œ</h2>
        <p class="location">ğŸ“ ì¥ì†Œ: ì‹œí—˜ ì‹œê°„ - êµì‹¤</p>
        <p class="situation">
            ì‹œí—˜ ì¢…ë£Œ 5ë¶„ ì „. ë§ˆì§€ë§‰ ë¬¸ì œë¥¼ ë¶™ì¡ê³  ìˆì§€ë§Œ... ì•„, ë„ì €íˆ ëª¨ë¥´ê² ë‹¤!<br>
            í•˜ì§€ë§Œ í¬ê¸°í•  ìˆœ ì—†ì§€. ë‹µì€ 4ê°œì˜ ì„ íƒì§€ ì¤‘ í•˜ë‚˜!
        </p>
        <p class="dilemma">ğŸ¤” ë‹¹ì‹ ì˜ ê³ ë¯¼: ì–´ë–¤ ë²ˆí˜¸ë¡œ ì°ì–´ì•¼ í• ê¹Œ? ë‚˜ì˜ ì§ê°ì„ ë¯¿ì–´ë³´ì!</p>
        <div class="choices">
            <button class="full-width" id="s4c1" onclick="handleChoice('screen4', 'A')">A) ì™ ì§€ ëŠë‚Œì´ ì˜¤ëŠ” 1ë²ˆ!</button>
            <button class="full-width" id="s4c2" onclick="handleChoice('screen4', 'B')">B) ê°€ì¥ ì•ˆ ë‚˜ì˜¬ ê²ƒ ê°™ì€ 2ë²ˆ!</button>
            <button class="full-width" id="s4c3" onclick="handleChoice('screen4', 'C')">C) ë‚˜ì˜ í–‰ìš´ì˜ ìˆ«ì 3ë²ˆ!</button>
            <button class="full-width" id="s4c4" onclick="handleChoice('screen4', 'D')">D) ëª¨ë¥´ê² ì„ ë• ë§ˆì§€ë§‰ ë²ˆí˜¸ 4ë²ˆ!</button>
        </div>
        <div class="immediate-feedback" id="feedback4"></div>
        <button class="next-button" id="nextBtn4" onclick="proceedToNext(4)">ë‹¤ìŒìœ¼ë¡œ</button>
    </div>

    <div id="screen5" class="game-screen">
        <h2 class="screen-title">ì„ íƒ 5: ë¹µì§‘ì˜ ìš´ëª…, ë§ˆì§€ë§‰ ì´ˆì½” í¬ë¦¼ë¹µ</h2>
        <p class="location">ğŸ“ ì¥ì†Œ: ë™ë„¤ ë¹µì§‘</p>
        <p class="situation">
            ë‚´ê°€ ì œì¼ ì¢‹ì•„í•˜ëŠ” ì´ˆì½” í¬ë¦¼ë¹µì„ ì‚¬ëŸ¬ ë¹µì§‘ì— ì™”ë‹¤.<br>
            ê·¸ëŸ°ë°... ë‚´ ì•ì— ì´ë¯¸ ë‘ ëª…ì´ ì¤„ì„ ì„œ ìˆê³ , ì§„ì—´ëŒ€ì—ëŠ” ì´ˆì½” í¬ë¦¼ë¹µì´ <span class="highlight">ë”± í•œ ê°œ</span> ë‚¨ì•„ìˆë‹¤!<br>
            ì• ì‚¬ëŒë“¤ì€ ë¹µì„ í•˜ë‚˜ì”©ë§Œ ì‚´ ì˜ˆì •ì´ê³ , ê°ì ì´ ì´ˆì½” í¬ë¦¼ë¹µì„ ê³ ë¥¼ í™•ë¥ ì€ <span class="highlight">50%</span>ë¼ê³  í•œë‹¤.
        </p>
        <p class="dilemma">ğŸ¤” ë‹¹ì‹ ì˜ ê³ ë¯¼: ì´ ì¤„, ê³„ì† ì„œì•¼ í• ê¹Œ? ì•„ë‹ˆë©´ ë‹¤ë¥¸ ë¹µì„ ì°¾ì•„ ë– ë‚ ê¹Œ?</p>
        <div class="choices">
            <button class="full-width" id="s5c1" onclick="handleChoice('screen5', 'A')">A) ë§ˆì§€ë§‰ í¬ë§ì„ ê±¸ê³  ê¸°ë‹¤ë ¤ë³¸ë‹¤!</button>
            <button class="full-width" id="s5c2" onclick="handleChoice('screen5', 'B')">B) ì´ê±´ í™•ë¥ ì´ ë„ˆë¬´ ë‚®ì•„... í¬ê¸°í•˜ê³  ë‹¤ë¥¸ ë¹µì§‘ì— ê°€ë³´ì.</button>
        </div>
        <div class="immediate-feedback" id="feedback5"></div>
        <button class="next-button" id="nextBtn5" onclick="proceedToNext(5)">ë‹¤ìŒìœ¼ë¡œ</button>
    </div>

    <div id="screen6" class="game-screen">
        <h2 class="screen-title">ì„ íƒ 6: ë„ì„œê´€ì—ì„œ ë§Œë‚  í™•ë¥ ì€?</h2>
        <p class="location">ğŸ“ ì¥ì†Œ: ì£¼ë§ ì˜¤í›„, ë‚˜ì˜ ë°©</p>
        <p class="situation">
            ì£¼ë§ ì˜¤í›„, ë”±íˆ í•  ì¼ì´ ë– ì˜¤ë¥´ì§€ ì•ŠëŠ”ë‹¤.<br>
            ë„ì„œê´€ì— ê°€ë©´ í˜¹ì‹œ ì¹œêµ¬ë“¤ì„ ë§Œë‚  ìˆ˜ ìˆì„ì§€ë„ ëª¨ë¥¸ë‹¤.<br>
            ìˆ˜ë¯¸ê°€ ì˜¤ëŠ˜ ë„ì„œê´€ì— ì˜¬ í™•ë¥ ì€ <span class="highlight">50%(1/2)</span>, ì§€ì€ì´ê°€ ì˜¬ í™•ë¥ ì€ ì•½ <span class="highlight">33%(1/3)</span>ì´ë¼ê³  í•œë‹¤.<br>
            ë‘˜ ë‹¤ ë§Œë‚˜ë©´ ì‹¬ì‹¬í•˜ì§€ ì•Šê³  ì •ë§ ì¢‹ì„ í…ë°...
        </p>
        <p class="dilemma">ğŸ¤” ë‹¹ì‹ ì˜ ê³ ë¯¼: ë„ì„œê´€ì— ê°€ ë³¼ê¹Œ?</p>
        <div class="choices">
            <button class="full-width" id="s6c1" onclick="handleChoice('screen6', 'A')">A) ê·¸ë˜, í˜¹ì‹œ ëª¨ë¥´ë‹ˆ ê°€ì„œ ì¹œêµ¬ë“¤ì„ ê¸°ë‹¤ë ¤ë³´ì!</button>
            <button class="full-width" id="s6c2" onclick="handleChoice('screen6', 'B')">B) ìŒ... ë‘˜ ë‹¤ ëª» ë§Œë‚  ìˆ˜ë„ ìˆìœ¼ë‹ˆ ê·¸ëƒ¥ ì˜¤ëŠ˜ì€ ì§‘ì— ìˆì.</button>
        </div>
        <div class="immediate-feedback" id="feedback6"></div>
        <button class="next-button" id="nextBtn6" onclick="proceedToNext(6)">ë‹¤ìŒìœ¼ë¡œ</button>
    </div>

    <div id="endingScreen" class="game-screen">
        <h2 class="screen-title">ë‚˜ì˜ í•˜ë£¨ ëŒì•„ë³´ê¸°</h2>
        <div id="endingTextOutput" class="ending-text">
            <p>ë‚˜ì˜ ì„ íƒë“¤ì´ ëª¨ì—¬ ì´ëŸ° í•˜ë£¨ê°€ ë˜ì—ˆì–´ìš”...</p>
        </div>
        <div class="choices">
            <button class="full-width" onclick="restartGame()">ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
        </div>
    </div>
</div>

<script>
    let currentScreenNum = 1;
    let money = 1000;
    const chocoBreadPrice = 1000;
    let rainChancePercentage = 0;
    let endingTexts = [];
    let playerStats = {
        hasUmbrella: false,
        lotteryPrize: false,
        lotteryAttempts: 0,
        lotterySpent: 0,
        gotChocoBread: false,
        latePenalty: false,
        quizCorrect: false
    };

    function initializeGame() {
        rainChancePercentage = Math.floor(Math.random() * 81) + 10;
        document.getElementById('rainChance').textContent = rainChancePercentage;
        updateMoneyDisplay();
        for (let i = 1; i <= 6; i++) {
            disableChoiceButtons('screen' + i, false);
            const feedbackDiv = document.getElementById('feedback' + i);
            const nextButton = document.getElementById('nextBtn' + i);
            if(feedbackDiv) feedbackDiv.innerHTML = "";
            if(nextButton) nextButton.style.display = 'none';
        }
        const choices2Initial = document.getElementById('choices2_initial');
        if(choices2Initial) choices2Initial.style.display = 'block';
        showScreen(currentScreenNum);
    }

    function showScreen(screenNumber) {
        document.querySelectorAll('.game-screen').forEach(screen => {
            screen.classList.remove('active');
        });
        const targetScreen = document.getElementById(screenNumber === 'Ending' ? 'endingScreen' : 'screen' + screenNumber);
        if(targetScreen) {
            targetScreen.classList.add('active');
        }
    }

    function updateMoneyDisplay() {
        const moneyDisplayLottery = document.getElementById('currentMoneyLottery');
        if (moneyDisplayLottery) moneyDisplayLottery.textContent = money;
    }

    function disableChoiceButtons(screenIdOrNum, disable = true) {
        const screenId = (typeof screenIdOrNum === 'string') ? screenIdOrNum : 'screen' + screenIdOrNum;
        const screen = document.getElementById(screenId);
        if (screen) {
            const choiceDiv = screen.querySelector('.choices'); 
            if(choiceDiv) {
                choiceDiv.querySelectorAll('button').forEach(button => {
                    button.disabled = disable;
                });
            }
            if (screenId === 'screen2') {
                const initialChoices2 = document.getElementById('choices2_initial');
                if (initialChoices2) {
                    initialChoices2.querySelectorAll('button').forEach(button => {
                        button.disabled = disable;
                    });
                }
            }
        }
    }

    function showNextButton(screenNum, show = true) {
         const nextButton = document.getElementById('nextBtn' + screenNum);
         if(nextButton) {
            nextButton.style.display = show ? 'block' : 'none';
         }
    }

    function displayImmediateFeedback(screenNum, feedbackHtml, showMainNextBtn = false) {
        const feedbackDiv = document.getElementById('feedback' + screenNum);
        if(feedbackDiv){
            feedbackDiv.innerHTML = feedbackHtml;
        }
        // í™”ë©´ 2ì˜ ì´ˆê¸° ë²„íŠ¼ì€ handleLotteryChoiceì—ì„œ ë³„ë„ ê´€ë¦¬í•˜ë¯€ë¡œ, ì—¬ê¸°ì„œëŠ” ì¼ë°˜ì ì¸ ê²½ìš°ë§Œ ì²˜ë¦¬
        if (screenNum !== 2) {
            disableChoiceButtons(screenNum, true);
        }
        if(showMainNextBtn) {
             showNextButton(screenNum, true);
        }
    }

    function handleLotteryChoice(action) {
        const feedbackDiv = document.getElementById('feedback2');
        const initialChoicesDiv = document.getElementById('choices2_initial');
        const mainNextButton = document.getElementById('nextBtn2');
        let feedbackHtml = "";

        if(initialChoicesDiv) initialChoicesDiv.style.display = 'none';
        mainNextButton.style.display = 'none';

        if (action === 'initial_pass') {
            feedbackHtml = "<h4>ê²°ê³¼: ë„ì „ í¬ê¸°</h4><p>ì„±ê³µ í™•ë¥  10%ëŠ” ì—¬ì „íˆ ë‚®ë‹¤ê³  íŒë‹¨í•˜ì—¬, ì‹ ì¤‘í•˜ê²Œ ëˆì„ ì•„ë¼ê¸°ë¡œ ê²°ì •í–ˆìŠµë‹ˆë‹¤.</p>";
            endingTexts.push("[10%ì˜ ë½‘ê¸° í™•ë¥  ì•ì—ì„œ ë„ì „ì„ í¬ê¸°í•˜ê³  ëˆì„ ì•„ê¼ˆë‹¤.]");
            feedbackDiv.innerHTML = feedbackHtml;
            showNextButton(2, true); 
        } else if (action === 'initial_try' || action === 'retry') {
            if (money >= 100) {
                money -= 100;
                playerStats.lotteryAttempts++;
                playerStats.lotterySpent += 100;
                updateMoneyDisplay();
                let success = Math.random() < 0.10; // *** ë½‘ê¸° ì„±ê³µ í™•ë¥  10%ë¡œ ë³€ê²½ ***

                if (success) {
                    playerStats.lotteryPrize = true;
                    feedbackHtml = `<h4>ê²°ê³¼: ğŸ‰ ëŒ€ì„±ê³µ! (${playerStats.lotteryAttempts}ë²ˆì§¸ ì‹œë„) ğŸ‰</h4><p>ìƒí’ˆ ë½‘ê¸° ì„±ê³µ í™•ë¥  <span class="highlight">10%</span>ì— ë„ì „í•˜ì—¬, ë“œë””ì–´ ìƒí’ˆì„ ë½‘ì•˜ìŠµë‹ˆë‹¤! ì´ ${playerStats.lotterySpent}ì›ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.</p>`;
                    feedbackDiv.innerHTML = feedbackHtml;
                    showNextButton(2, true); 
                } else {
                    feedbackHtml = `<h4>ê²°ê³¼: ê½! (ì‹œë„ íšŸìˆ˜: ${playerStats.lotteryAttempts}, ë‚¨ì€ ëˆ: ${money}ì›)</h4><p>ìƒí’ˆ ë½‘ê¸° ì„±ê³µ í™•ë¥  <span class="highlight">10%</span>ì— ë„ì „í–ˆì§€ë§Œ, ì•„ì‰½ê²Œë„ 90%ì˜ ì‹¤íŒ¨ í™•ë¥ ì´ ë” ë†’ì•˜ë„¤ìš”. 100ì›ì„ ìƒì—ˆìŠµë‹ˆë‹¤.</p>`;
                    if (money >= 100) {
                        feedbackHtml += `<div class="feedback-actions"><button onclick="handleLotteryChoice('retry')">ë‹¤ì‹œ ë„ì „í•œë‹¤! (100ì› ì‚¬ìš©)</button> <button onclick="quitLotteryAndProceed()">ê·¸ë§Œí•˜ê³  ë‹¤ìŒìœ¼ë¡œ ë„˜ì–´ê°„ë‹¤.</button></div>`;
                    } else {
                        feedbackHtml += "<p>ëˆì´ ë¶€ì¡±í•˜ì—¬ ë” ì´ìƒ ë„ì „í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>";
                        feedbackHtml += `<div class="feedback-actions"><button onclick="quitLotteryAndProceed()">ë‹¤ìŒìœ¼ë¡œ ë„˜ì–´ê°„ë‹¤.</button></div>`;
                    }
                    feedbackDiv.innerHTML = feedbackHtml;
                }
            } else {
                feedbackHtml = "<h4>ê²°ê³¼: ì‹œë„ ì‹¤íŒ¨!</h4><p>ë½‘ê¸°ì— ë„ì „í•˜ê³  ì‹¶ì—ˆì§€ë§Œ, ì•„ì‰½ê²Œë„ ëˆì´ ë¶€ì¡±í•´ì„œ ì‹œë„ì¡°ì°¨ ëª»í–ˆìŠµë‹ˆë‹¤.</p>";
                feedbackDiv.innerHTML = feedbackHtml;
                showNextButton(2, true); 
            }
        }
    }

    function quitLotteryAndProceed() {
        proceedToNext(2);
    }

    function handleChoice(screenId, choice) {
        const screenNum = parseInt(screenId.replace('screen', ''));
        if (screenNum === 2) { 
            handleLotteryChoice(choice === 'A' ? 'initial_try' : 'initial_pass');
            return;
        }

        let feedbackHtml = "";
        let endingText = "";
        let showMainNextBtn = true;

        if (screenNum === 1) {
            let actuallyRained = Math.random() * 100 < rainChancePercentage;
            feedbackHtml += `<h4>ê²°ê³¼: ${actuallyRained ? "ë¹„ê°€ ì‹¤ì œë¡œ ë‚´ë ¸ìŠµë‹ˆë‹¤!" : "ì˜¤ëŠ˜ì€ ë¹„ê°€ ì˜¤ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!"}</h4>`;
            feedbackHtml += `<p>ì˜¤ëŠ˜ ë¹„ ì˜¬ í™•ë¥ ì€ ${rainChancePercentage}%ì˜€ìŠµë‹ˆë‹¤. ì´ í™•ë¥ ì— ë”°ë¼ ë‚ ì”¨ê°€ ê²°ì •ë˜ì—ˆì–´ìš”.</p>`;

            if (choice === 'A') {
                playerStats.hasUmbrella = true;
                endingText = actuallyRained ? "[ë¹„ ì˜¤ëŠ” ë‚ , ìš°ì‚°ì„ ì±™ê²¨ê°„ ë•ë¶„ì— ë³´ì†¡ë³´ì†¡í•˜ê²Œ í•˜ë£¨ë¥¼ ë³´ëƒˆë‹¤.]" : "[ë§‘ì€ ë‚ , í˜¹ì‹œë‚˜ í•´ì„œ ì±™ê²¼ë˜ ìš°ì‚°ì´ ì¡°ê¸ˆ ë¬´ê±°ì› ì§€ë§Œ ê·¸ë˜ë„ ì•ˆì‹¬ì´ì—ˆë‹¤.]";
                feedbackHtml += `<p>ë‹¹ì‹ ì€ ìš°ì‚°ì„ ì±™ê²¼ìŠµë‹ˆë‹¤. ${actuallyRained ? "í˜„ëª…í•œ ì„ íƒì´ì—ˆë„¤ìš”!" : "ì¡°ê¸ˆ ë²ˆê±°ë¡œì› ì„ ìˆ˜ë„ ìˆì§€ë§Œ, ëŒ€ë¹„ëŠ” ì¢‹ì€ ê±°ì£ !"}</p>`;
            } else { 
                playerStats.hasUmbrella = false;
                endingText = actuallyRained ? "[ë¹„ ì˜¤ëŠ” ë‚ , ìš°ì‚°ì„ ì•ˆ ê°€ì ¸ê°€ì„œ ê²°êµ­ ì˜ˆìƒì¹˜ ëª»í•œ ë¹„ì— ì«„ë”± ì –ê³  ë§ì•˜ë‹¤.]" : "[ë§‘ì€ ë‚ , ìš°ì‚°ì„ ì•ˆ ê°€ì ¸ê°„ ë‚˜ì˜ ê°€ë²¼ìš´ ë°œê±¸ìŒì€ íƒì›”í•œ ì„ íƒì´ì—ˆë‹¤!]";
                feedbackHtml += `<p>ë‹¹ì‹ ì€ ìš°ì‚°ì„ ì±™ê¸°ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ${actuallyRained ? "ì´ëŸ°! ë¹„ë¥¼ ë§ê²Œ ë˜ì—ˆë„¤ìš”." : "ì˜ˆì¸¡ ì„±ê³µ! ê°€ë¿í•œ í•˜ë£¨!"}</p>`;
            }
        }
        else if (screenNum === 3) { 
            let teacherAtMainGate = Math.random() < 0.5; 
            let caught = false;
            feedbackHtml += `<h4>ê²°ê³¼: ì„ ìƒë‹˜ì€... ${teacherAtMainGate ? "ì •ë¬¸" : "í›„ë¬¸"}ì— ê³„ì…¨ìŠµë‹ˆë‹¤!</h4><p>(ê° ë¬¸ì— ì„ ìƒë‹˜ì´ ê³„ì‹¤ í™•ë¥ ì€ 50%ì˜€ìŠµë‹ˆë‹¤.)</p>`;

            if (choice === 'A') { 
                if (teacherAtMainGate) {
                    caught = true;
                    endingText = "[ì§€ê°í•´ì„œ ì •ë¬¸ìœ¼ë¡œ ë“¤ì–´ê°”ì§€ë§Œ, ê²°êµ­ ì„ ìƒë‹˜ê»˜ ë¶™ì¡í˜€ ë”°ë”í•œ í›ˆê³„ë¥¼ ë“¤ì–´ì•¼ í–ˆë‹¤.]";
                    feedbackHtml += "<p>ì´ëŸ°! ì •ë¬¸ìœ¼ë¡œ ë“¤ì–´ê°”ë‹¤ê°€ ë‹¨ì†ì— ê±¸ë ¸ìŠµë‹ˆë‹¤!</p>";
                } else {
                    endingText = "[ì§€ê°í–ˆì§€ë§Œ ì •ë¬¸ìœ¼ë¡œ í–¥í–ˆê³ , ë‹¤í–‰íˆ ì„ ìƒë‹˜ì´ ì•ˆ ê³„ì…”ì„œ ë¬´ì‚¬íˆ êµì‹¤ë¡œ ë“¤ì–´ê°”ë‹¤!]";
                    feedbackHtml += "<p>íœ´! ì •ë¬¸ì—ëŠ” ì„ ìƒë‹˜ì´ ì•ˆ ê³„ì…¨ë„¤ìš”. ë¬´ì‚¬ í†µê³¼!</p>";
                }
            } else { 
                if (!teacherAtMainGate) { 
                    caught = true;
                    endingText = "[ì§€ê°í•´ì„œ í›„ë¬¸ìœ¼ë¡œ ë“¤ì–´ê°”ì§€ë§Œ, ê²°êµ­ ì„ ìƒë‹˜ì˜ ëˆˆì„ í”¼í•˜ì§€ ëª»í•˜ê³  ì”ì†Œë¦¬ë¥¼ ë“£ê²Œ ë˜ì—ˆë‹¤.]";
                    feedbackHtml += "<p>ì´ëŸ°! í›„ë¬¸ìœ¼ë¡œ ë“¤ì–´ê°”ë‹¤ê°€ ë‹¨ì†ì— ê±¸ë ¸ìŠµë‹ˆë‹¤!</p>";
                } else {
                    endingText = "[ì§€ê°í–ˆì§€ë§Œ í›„ë¬¸ìœ¼ë¡œ í–¥í–ˆê³ , ë‹¤í–‰íˆ ì„ ìƒë‹˜ì´ ì•ˆ ê³„ì…”ì„œ ì¡°ìš©íˆ êµì‹¤ë¡œ ë“¤ì–´ê°ˆ ìˆ˜ ìˆì—ˆë‹¤!]";
                    feedbackHtml += "<p>íœ´! í›„ë¬¸ì—ëŠ” ì„ ìƒë‹˜ì´ ì•ˆ ê³„ì…¨ë„¤ìš”. ë¬´ì‚¬ í†µê³¼!</p>";
                }
            }
            playerStats.latePenalty = caught;
        }
        else if (screenNum === 4) { 
            let correctAnswer = Math.floor(Math.random() * 4) + 1; 
            let playerPick = 0;
            if (choice === 'A') playerPick = 1;
            else if (choice === 'B') playerPick = 2;
            else if (choice === 'C') playerPick = 3;
            else if (choice === 'D') playerPick = 4;

            playerStats.quizCorrect = (playerPick === correctAnswer);
            feedbackHtml = `<h4>ê²°ê³¼: ë‹¹ì‹ ì˜ ì„ íƒì€ ${playerPick}ë²ˆ!</h4><p>(ê° ì„ íƒì§€ê°€ ì •ë‹µì¼ í™•ë¥ ì€ 1/4 = 25%ì…ë‹ˆë‹¤.)</p>`;
            if (playerStats.quizCorrect) {
                feedbackHtml += `<p>ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰ ìš´ì´ ì¢‹ì•˜ë„¤ìš”!</p>`;
                endingText = `[ì‹œí—˜ ì¤‘ ëª¨ë¥´ëŠ” ë¬¸ì œëŠ” ${playerPick}ë²ˆìœ¼ë¡œ ì°ì—ˆëŠ”ë°, í–‰ìš´ì˜ ì—¬ì‹ ì´ í•¨ê»˜í–ˆëŠ”ì§€ ì •ë‹µì´ì—ˆë‹¤!]`;
            } else {
                feedbackHtml += `<p>ì•„ì‰½ì§€ë§Œ ì˜¤ë‹µì…ë‹ˆë‹¤. (ì •ë‹µì€ ${correctAnswer}ë²ˆì´ì—ˆìŠµë‹ˆë‹¤.)</p>`;
                endingText = `[ì‹œí—˜ ì¤‘ ëª¨ë¥´ëŠ” ë¬¸ì œëŠ” ${playerPick}ë²ˆìœ¼ë¡œ ì°ì—ˆì§€ë§Œ, ì•„ì‰½ê²Œë„ ì •ë‹µì„ í”¼í•´ê°”ë‹¤. (ì •ë‹µ:${correctAnswer}ë²ˆ)]`;
            }
        }
        else if (screenNum === 5) { 
             if (choice === 'A') {
                let person1Buys = Math.random() < 0.5; 
                let person2Buys = Math.random() < 0.5; 
                let breadAvailableForPlayer = true;

                feedbackHtml = "<h4>ê²°ê³¼: ë¹µì˜ í–‰ë°©ì€?</h4>"
                if (person1Buys) {
                    breadAvailableForPlayer = false;
                    feedbackHtml += "<p>ì²« ë²ˆì§¸ ì‚¬ëŒì´ ì´ˆì½” í¬ë¦¼ë¹µì„ ì‚¬ê°”ìŠµë‹ˆë‹¤! (ì„ íƒ í™•ë¥  50%)</p>";
                } else {
                    feedbackHtml += "<p>ì²« ë²ˆì§¸ ì‚¬ëŒì€ ë‹¤ë¥¸ ë¹µì„ ê³¨ëìŠµë‹ˆë‹¤. (ë‹¤ë¥¸ ë¹µ ì„ íƒ í™•ë¥  50%)</p>";
                    if (person2Buys) {
                        breadAvailableForPlayer = false;
                        feedbackHtml += "<p>ì´ì–´ì„œ ë‘ ë²ˆì§¸ ì‚¬ëŒì´ ì´ˆì½” í¬ë¦¼ë¹µì„ ì‚¬ê°”ìŠµë‹ˆë‹¤! (ì„ íƒ í™•ë¥  50%)</p>";
                    } else {
                        feedbackHtml += "<p>ë‘ ë²ˆì§¸ ì‚¬ëŒë„ ë‹¤ë¥¸ ë¹µì„ ê³¨ëìŠµë‹ˆë‹¤! (ë‹¤ë¥¸ ë¹µ ì„ íƒ í™•ë¥  50%)</p>";
                    }
                }

                if (breadAvailableForPlayer) {
                    feedbackHtml += "<p><strong>ê¸°íšŒ!</strong> ì•ì˜ ë‘ ì‚¬ëŒì´ ëª¨ë‘ ë‹¤ë¥¸ ë¹µì„ ê³ ë¥¼ í™•ë¥ (0.5 Ã— 0.5 = 0.25, ì¦‰ 25%)ì´ í˜„ì‹¤ì´ ë˜ì–´, ë“œë””ì–´ ë‹¹ì‹  ì°¨ë¡€ì…ë‹ˆë‹¤!</p>";
                    if (money >= chocoBreadPrice) {
                        money -= chocoBreadPrice;
                        playerStats.gotChocoBread = true;
                        feedbackHtml += "<p>ğŸ‰ ì´ˆì½” í¬ë¦¼ë¹µì„ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤! ë§›ìˆê²Œ ë“œì„¸ìš”!</p>";
                        endingText = "[ì´ˆì½” í¬ë¦¼ë¹µ ì¤„ì—ì„œ ëˆê¸° ìˆê²Œ ê¸°ë‹¤ë¦° ê²°ê³¼, ë§ˆì§€ë§‰ ë‚¨ì€ ë¹µì„ ì°¨ì§€í•  ìˆ˜ ìˆì—ˆë‹¤! ì •ë§ ê¿€ë§›ì´ì—ˆë‹¤.]";
                    } else {
                        feedbackHtml += "<p>ì´ëŸ°... ë¹µì€ ë‚¨ì•˜ì§€ë§Œ ëˆì´ ë¶€ì¡±í•´ì„œ ì‚´ ìˆ˜ê°€ ì—†ë„¤ìš”.</p>";
                        endingText = "[ë‚´ ì°¨ë¡€ê¹Œì§€ ì´ˆì½” í¬ë¦¼ë¹µì´ ë‚¨ì•„ ìˆì—ˆì§€ë§Œ, ì´ëŸ°! ëˆì´ ë¶€ì¡±í•´ì„œ ê²°êµ­ ì‚¬ì§€ ëª»í–ˆë‹¤. ë‹¤ë¥¸ ê³³ì— ì“°ì§€ ë§ ê±¸...]";
                    }
                } else {
                    feedbackHtml += "<p>ì•„ì‰½ê²Œë„ ì•ì‚¬ëŒ ì¤‘ ëˆ„êµ°ê°€ê°€ ë§ˆì§€ë§‰ ì´ˆì½” í¬ë¦¼ë¹µì„ ì‚¬ ë²„ë ¸ìŠµë‹ˆë‹¤. (ëˆ„êµ°ê°€ ì‚´ í™•ë¥  75%)</p>";
                    endingText = "[ê¸°ëŒ€í•˜ë©° ì´ˆì½” í¬ë¦¼ë¹µ ì¤„ì„ ê¸°ë‹¤ë ¸ì§€ë§Œ, ì•„ì‰½ê²Œë„ ë°”ë¡œ ì•ì—ì„œ ë§ˆì§€ë§‰ ë¹µì´ íŒ”ë ¤ë²„ë ¸ë‹¤.]";
                }
            } else { 
                feedbackHtml = "<h4>ê²°ê³¼: ë‹¤ë¥¸ ë¹µì§‘ìœ¼ë¡œ...</h4><p>ë§ˆì§€ë§‰ ë¹µì„ ê¸°ë‹¤ë¦¬ëŠ” ëŒ€ì‹  ë‹¤ë¥¸ ë¹µì§‘ìœ¼ë¡œ í–¥í–ˆìŠµë‹ˆë‹¤. ê·¸ê³³ì—” ë¹µì´ ìˆì—ˆì„ê¹Œìš”?</p>";
                endingText = "[ì´ˆì½” í¬ë¦¼ë¹µì„ í¬ê¸°í•˜ê³  ë‹¤ë¥¸ ë¹µì§‘ê¹Œì§€ ê°€ë´¤ì§€ë§Œ, ê²°êµ­ ê±°ê¸°ì—ë„ ì—†ì–´ ì˜¤ëŠ˜ì€ ì´ˆì½” í¬ë¦¼ë¹µì„ ë§›ë³´ì§€ ëª»í–ˆë‹¤.]";
            }
        }
        else if (screenNum === 6) { // ë„ì„œê´€
            let sumiComes = Math.random() < 0.5; 
            let jieunComes = Math.random() < (1/3); 

            if (choice === 'A') { // ë„ì„œê´€ì— ê°„ ê²½ìš°
                feedbackHtml = "<h4>ê²°ê³¼: ë„ì„œê´€ì—ëŠ”...</h4>";
                feedbackHtml += `<p>ìˆ˜ë¯¸ê°€ ì˜¬ í™•ë¥ (50%)ì€ ${sumiComes ? "í˜„ì‹¤ë¡œ!" : "ë¹—ë‚˜ê°”ê³ ,"} ì§€ì€ì´ê°€ ì˜¬ í™•ë¥ (ì•½ 33%)ì€ ${jieunComes ? "í˜„ì‹¤ì´ ë˜ì—ˆë„¤ìš”!" : "ë¹—ë‚˜ê°”ìŠµë‹ˆë‹¤."}</p>`;

                if (sumiComes && jieunComes) {
                    feedbackHtml += "<p>ğŸ‰ ë‘ ì¹œêµ¬ë¥¼ ëª¨ë‘ ë§Œë‚¬ìŠµë‹ˆë‹¤! (ìˆ˜ë¯¸ì™€ ì§€ì€ì´ ë‘˜ ë‹¤ ë§Œë‚  í™•ë¥ : 0.5 Ã— 0.33 â‰ˆ 16.5%)</p>";
                    endingText = "[ë„ì„œê´€ì— ê°”ë”ë‹ˆ, ê¸°ëŒ€í–ˆë˜ ëŒ€ë¡œ ìˆ˜ë¯¸ì™€ ì§€ì€ì´ë¥¼ ë‘˜ ë‹¤ ë§Œë‚˜ ì¦ê±°ìš´ ì‹œê°„ì„ ë³´ëƒˆë‹¤!]";
                } else if (sumiComes) {
                    feedbackHtml += "<p>ìˆ˜ë¯¸ë§Œ ë§Œë‚¬ìŠµë‹ˆë‹¤. (ìˆ˜ë¯¸ë§Œ ì˜¬ í™•ë¥ : 0.5 Ã— (1-1/3) â‰ˆ 33.3%)</p>";
                    endingText = "[ë„ì„œê´€ì—ì„œ ìˆ˜ë¯¸ëŠ” ë§Œë‚¬ì§€ë§Œ, ì§€ì€ì´ëŠ” ì˜¤ì§€ ì•Šì•„ ì¡°ê¸ˆ ì•„ì‰¬ì› ë‹¤.]";
                } else if (jieunComes) {
                    feedbackHtml += "<p>ì§€ì€ì´ë§Œ ë§Œë‚¬ìŠµë‹ˆë‹¤. ((1-0.5) Ã— 1/3 â‰ˆ 16.7%)</p>";
                    endingText = "[ë„ì„œê´€ì—ì„œ ì§€ì€ì´ëŠ” ë§Œë‚¬ì§€ë§Œ, ìˆ˜ë¯¸ëŠ” ì˜¤ì§€ ì•Šì•„ ì¡°ê¸ˆ ì•„ì‰¬ì› ë‹¤.]";
                } else {
                    feedbackHtml += "<p>ì•„ë¬´ë„ ë§Œë‚˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (ë‘˜ ë‹¤ ì•ˆ ì˜¬ í™•ë¥ : (1-0.5) Ã— (1-1/3) â‰ˆ 33.3%)</p>";
                    endingText = "[ë„ì„œê´€ì— ê°”ì§€ë§Œ, ê¸°ëŒ€ì™€ ë‹¬ë¦¬ ìˆ˜ë¯¸ë„ ì§€ì€ì´ë„ ì—†ì–´ í™€ë¡œ ì±…ë§Œ ì½ë‹¤ ëŒì•„ì™”ë‹¤.]";
                }
            } else { // B ì„ íƒ (ë„ì„œê´€ì— ì•ˆ ê°„ ê²½ìš°)
                feedbackHtml = "<h4>ê²°ê³¼: ì§‘ì—ì„œ íœ´ì‹</h4><p>ë‹¹ì‹ ì€ ì˜¤ëŠ˜ ë„ì„œê´€ì— ê°€ì§€ ì•Šê³  ì§‘ì—ì„œ ë‹¤ë¥¸ í™œë™ì„ í•˜ê¸°ë¡œ ê²°ì •í–ˆìŠµë‹ˆë‹¤.</p>";
                feedbackHtml += "<p class='player-thought'>ê·¸ ì‹œê°, ë„ì„œê´€ì—ì„œëŠ”...</p>"; 

                if (sumiComes && jieunComes) {
                    feedbackHtml += "<p>ìˆ˜ë¯¸ì™€ ì§€ì€ì´ ë‘˜ ë‹¤ ë„ì„œê´€ì— ì™”ì—ˆë„¤ìš”! (ë‘˜ ë‹¤ ì˜¬ í™•ë¥ : ì•½ 16.5%) ë‹¹ì‹ ì´ ê°”ë”ë¼ë©´ í•¨ê»˜ ì¦ê±°ì› ì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤.</p>";
                } else if (sumiComes) {
                    feedbackHtml += "<p>ìˆ˜ë¯¸ëŠ” ë„ì„œê´€ì— ì™”ì—ˆì§€ë§Œ, ì§€ì€ì´ëŠ” ì˜¤ì§€ ì•Šì•˜ì–´ìš”. (ìˆ˜ë¯¸ë§Œ ì˜¬ í™•ë¥ : ì•½ 33.3%) ë‹¹ì‹ ì´ ê°”ë”ë¼ë©´ ìˆ˜ë¯¸ì™€ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ´ì„ì§€ë„...</p>";
                } else if (jieunComes) {
                    feedbackHtml += "<p>ì§€ì€ì´ëŠ” ë„ì„œê´€ì— ì™”ì—ˆì§€ë§Œ, ìˆ˜ë¯¸ëŠ” ì˜¤ì§€ ì•Šì•˜ì–´ìš”. (ì§€ì€ì´ë§Œ ì˜¬ í™•ë¥ : ì•½ 16.7%) ë‹¹ì‹ ì´ ê°”ë”ë¼ë©´ ì§€ì€ì´ì™€ ì‹œê°„ì„ ë³´ëƒˆì„ì§€ë„...</p>";
                } else {
                    feedbackHtml += "<p>ìˆ˜ë¯¸ë„ ì§€ì€ì´ë„ ë„ì„œê´€ì— ì˜¤ì§€ ì•Šì•˜ë„¤ìš”. (ë‘˜ ë‹¤ ì•ˆ ì˜¬ í™•ë¥ : ì•½ 33.3%) ì–´ì©Œë©´ ì˜¤ëŠ˜ì€ ì§‘ì—ì„œ ì‰¬ëŠ” ê²Œ ì¢‹ì€ ì„ íƒì´ì—ˆì„ ìˆ˜ë„ ìˆê² ë„¤ìš”.</p>";
                }
                endingText = "[ì˜¤ëŠ˜ì€ ë„ì„œê´€ì— ê°€ëŠ” ëŒ€ì‹  ë‹¤ë¥¸ í™œë™ì„ í•˜ê¸°ë¡œ ê²°ì •í–ˆë‹¤. ê·¸ ì‹œê°„, ì¹œêµ¬ë“¤ì€ ë„ì„œê´€ì—ì„œ ê°ìì˜ ì‹œê°„ì„ ë³´ëƒˆì„ì§€ë„ ëª¨ë¥¸ë‹¤.]";
            }
        }


        if (endingText) endingTexts.push(endingText);
        // í™”ë©´ 2ê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ disableChoiceButtonsì™€ displayImmediateFeedback ì§ì ‘ í˜¸ì¶œ
        if (screenNum !== 2) {
            displayImmediateFeedback(screenNum, feedbackHtml, showMainNextBtn);
        }
    }

    function proceedToNext(prevScreenNum) {
        const feedbackDiv = document.getElementById('feedback' + prevScreenNum);
        const nextButton = document.getElementById('nextBtn' + prevScreenNum);
        if(feedbackDiv) feedbackDiv.innerHTML = "";
        if(nextButton) nextButton.style.display = 'none';
        
        // í™”ë©´ 2ì˜ ê²½ìš°, ì´ˆê¸° ì„ íƒì§€ ë²„íŠ¼ë“¤(choices2_initial)ì„ ë‹¤ì‹œ ë³´ì´ë„ë¡ ì²˜ë¦¬í•˜ê³ , ë²„íŠ¼ë“¤ë„ í™œì„±í™”
        if (prevScreenNum === 2) {
            const initialChoices2 = document.getElementById('choices2_initial');
            if (initialChoices2) {
                initialChoices2.style.display = 'block'; // ë‹¤ì‹œ ë³´ì´ê²Œ
                initialChoices2.querySelectorAll('button').forEach(button => {
                    button.disabled = false; // ë²„íŠ¼ í™œì„±í™”
                });
            }
        } else {
             // ë‹¤ë¥¸ í™”ë©´ë“¤ì˜ ë²„íŠ¼ë“¤ë„ ì¬ì‹œì‘ì„ ìœ„í•´ í™œì„±í™” (restartGameì—ì„œ ì „ì²´ì ìœ¼ë¡œ í•˜ì§€ë§Œ, ì—¬ê¸°ì„œë„ í•´ë‘ë©´ ì¢‹ìŒ)
            disableChoiceButtons('screen' + prevScreenNum, false);
        }


        currentScreenNum++;
        if (currentScreenNum > 6) {
            displayEnding();
        } else {
            showScreen(currentScreenNum);
            updateMoneyDisplay();
            // ë‹¤ìŒ í™”ë©´ì˜ ë²„íŠ¼ë“¤ë„ í™œì„±í™” (ê²Œì„ ì‹œì‘ ì‹œ initializeGameì—ì„œ í•˜ì§€ë§Œ, í˜¹ì‹œ ëª¨ë¥´ë‹ˆ)
            disableChoiceButtons(currentScreenNum, false);
            if (currentScreenNum === 2) { // ë‹¤ìŒ í™”ë©´ì´ 2ë²ˆ í™”ë©´ì¼ ê²½ìš°, ì´ˆê¸° ìƒíƒœë¡œ
                 const initialChoices2 = document.getElementById('choices2_initial');
                 if (initialChoices2) initialChoices2.style.display = 'block';
                 disableChoiceButtons('screen2', false);
            }
        }
    }

    function displayEnding() {
        showScreen('Ending');
        const endingOutput = document.getElementById('endingTextOutput');
        let fullEndingText = "<p><strong>ë‚˜ì˜ ì„ íƒë“¤ì´ ëª¨ì—¬ ì´ëŸ° í•˜ë£¨ê°€ ë˜ì—ˆì–´ìš”...</strong></p>";
        endingTexts.forEach(text => {
            fullEndingText += `<p>${text}</p>`;
        });

        if (playerStats.lotteryAttempts > 0) {
            if (playerStats.lotteryPrize) {
                fullEndingText += `<p>[ë½‘ê¸° ìš”ì•½: ì´ ${playerStats.lotterySpent}ì›ì„ ì‚¬ìš©í•˜ì—¬ ${playerStats.lotteryAttempts}ë²ˆì˜ ë„ì „ ëì— <span class="highlight">10%</span>ì˜ í™•ë¥ ì„ ëš«ê³  ìƒí’ˆì„ ì–»ì—ˆë‹¤!]</p>`;
            } else {
                fullEndingText += `<p>[ë½‘ê¸° ìš”ì•½: ì´ ${playerStats.lotterySpent}ì›ì„ ì‚¬ìš©í•˜ê³  ${playerStats.lotteryAttempts}ë²ˆ ë„ì „í–ˆì§€ë§Œ, ì•„ì‰½ê²Œë„ <span class="highlight">10%</span>ì˜ í™•ë¥  ì•ì—ì„œ ìƒí’ˆì„ ì–»ì§€ ëª»í–ˆë‹¤.]</p>`;
            }
        } else if (currentScreenNum > 2) { // ë½‘ê¸° í™”ë©´ì„ ê±°ì³¤ëŠ”ë° ì‹œë„ 0ë²ˆì´ë©´ í¬ê¸°í•œ ê²ƒ
             // ì´ë¯¸ handleLotteryChoice('initial_pass')ì—ì„œ endingTextsì— ì¶”ê°€ë¨. í•„ìš”ì‹œ ì¤‘ë³µ ì œê±°
        }


        fullEndingText += "<hr><p><strong>[í•˜ë£¨ ìš”ì•½ ë° ìƒíƒœ]</strong></p>";
        fullEndingText += `<p>ìµœì¢… ì†Œì§€ê¸ˆ: ${money}ì›</p>`;
        if(playerStats.hasUmbrella) fullEndingText += "<p>- ì±™ê²¨ê°„ ìš°ì‚°ì´ ìˆì—ˆë‹¤.</p>";
        if(playerStats.gotChocoBread) fullEndingText += "<p>- ë§›ìˆëŠ” ì´ˆì½” í¬ë¦¼ë¹µì„ ë¨¹ì—ˆë‹¤!</p>";
        if(playerStats.latePenalty) fullEndingText += "<p>- ì§€ê°ìœ¼ë¡œ ì„ ìƒë‹˜ê»˜ ê¾¸ì¤‘ì„ ë“¤ì—ˆë‹¤.</p>";
        
        // ì‹œí—˜ ê²°ê³¼ëŠ” currentScreenNumì´ 4ë¥¼ ë„˜ì–´ì•¼ ìœ íš¨í•¨ (ì‹œí—˜ì„ ë´¤ë‹¤ëŠ” ëœ»)
        if (document.getElementById('screen4').classList.contains('active') === false && currentScreenNum > 4) { // í™”ë©´4ë¥¼ ì§€ë‚˜ì™”ë‹¤ë©´
            if(playerStats.quizCorrect) fullEndingText += "<p>- ì‹œí—˜ì—ì„œ ì°ì€ ë¬¸ì œê°€ ì •ë‹µì´ì—ˆë‹¤!</p>";
            else fullEndingText += "<p>- ì‹œí—˜ì—ì„œ ì°ì€ ë¬¸ì œëŠ” í‹€ë ¸ë‹¤.</p>";
        }


        endingOutput.innerHTML = fullEndingText;
    }

    function restartGame() {
        currentScreenNum = 1;
        money = 1000;
        endingTexts = [];
        playerStats = {
            hasUmbrella: false,
            lotteryPrize: false,
            lotteryAttempts: 0,
            lotterySpent: 0,
            gotChocoBread: false,
            latePenalty: false,
            quizCorrect: false
        };
        initializeGame(); 
    }

    window.onload = initializeGame;
</script>

</body>
</html>