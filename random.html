<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš´ëª… ê°œì²™ì: ì¼ìƒ ì† í™•ë¥  ê²Œì„</title>
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f0f2f5;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden; /* í™”ë©´ í”ë“¤ë¦¼ ì‹œ ê°€ë¡œ ìŠ¤í¬ë¡¤ ë°©ì§€ */
        }
        .container {
            background-color: #fff;
            padding: 20px 30px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 750px;
            transition: transform 0.1s ease-out; /* í”ë“¤ë¦¼ ë¶€ë“œëŸ½ê²Œ */
        }
        .stage {
            display: none;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 25px;
            background-color: #ffffff;
        }
        .stage h2 {
            color: #1877f2; 
            margin-top: 0;
            border-bottom: 2px solid #1877f2;
            padding-bottom: 10px;
        }
        .stage .situation p, .stage .dilemma p {
            margin-bottom: 10px;
            color: #4b4f56;
        }
        .choices button {
            display: block;
            width: 100%;
            padding: 12px 15px;
            margin: 10px 0;
            background-color: #1877f2;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.2s ease, opacity 0.3s ease;
        }
        .choices button:hover {
            background-color: #166fe5;
        }
        .choices button:disabled { /* ì„ íƒ í›„ ë²„íŠ¼ ë¹„í™œì„±í™” ìŠ¤íƒ€ì¼ */
            background-color: #a0c3ff;
            cursor: not-allowed;
            opacity: 0.7;
        }
        .outcome-area {
            margin-top: 20px;
            padding: 15px;
            background-color: #f0f2f5;
            border-left: 4px solid #1877f2;
            border-radius: 0 6px 6px 0;
            display: none; 
        }
        .outcome-area .probabilities, .outcome-area .actual-result {
            margin-bottom: 8px;
            color: #4b4f56;
            min-height: 20px; /* íƒ€ì´í•‘ íš¨ê³¼ë¥¼ ìœ„í•œ ìµœì†Œ ë†’ì´ */
        }
        .outcome-area .probabilities strong, .outcome-area .actual-result strong {
            color: #1c1e21;
        }
        .outcome-text-good {
            color: #28a745 !important; /* ì´ˆë¡ìƒ‰, !importantë¡œ ìš°ì„ ìˆœìœ„ */
            font-weight: bold;
            font-size: 1.1em;
        }
        .outcome-text-bad {
            color: #dc3545 !important; /* ë¹¨ê°„ìƒ‰ */
            font-weight: bold;
            font-size: 1.2em; /* ë” í¬ê²Œ */
        }
        .outcome-text-neutral {
            color: #4b4f56 !important; /* ê¸°ë³¸ í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
        }

        .next-button {
            display: none; 
            width: 100%;
            padding: 12px 15px;
            margin-top: 20px;
            background-color: #42b72a; 
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        .next-button:hover {
            background-color: #36a420;
        }
        #summaryContainer {
            background-color: #f0f2f5;
            padding: 20px;
            border-radius: 8px;
        }
        #recapList li {
            background-color: #fff;
            margin-bottom: 12px;
            padding: 15px;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            list-style-type: none;
        }
        #recapList li strong {
            color: #1877f2; display: block; margin-bottom: 5px;
        }
        h1 {
            color: #1c1e21;
            text-align: center;
            margin-bottom: 25px;
        }
        .highlight-prob { 
            color: #e74c3c;
            font-weight: bold;
        }

        /* í™”ë©´ í”ë“¤ë¦¼ ì• ë‹ˆë©”ì´ì…˜ */
        .screen-shake {
            animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both;
        }
        @keyframes shake {
            10%, 90% { transform: translateX(-2px); }
            20%, 80% { transform: translateX(3px); }
            30%, 50%, 70% { transform: translateX(-5px); }
            40%, 60% { transform: translateX(5px); }
        }

        @media (max-width: 600px) {
            .container { padding: 15px; }
            .stage { padding: 15px; }
            .choices button, .next-button { font-size: 15px; padding: 10px; }
            #playerNameInput { width: calc(100% - 22px); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ² ìš´ëª… ê°œì²™ì: ì¼ìƒ ì† í™•ë¥  ê²Œì„ ğŸ•¹ï¸</h1>

        <div id="stage0" class="stage">
            <h2>ê²Œì„ ì‹œì‘!</h2>
            <p>"í‰ë²”í•´ ë³´ì´ëŠ” ì˜¤ëŠ˜ í•˜ë£¨, í¬ê³  ì‘ì€ ì„ íƒë“¤ì´ ë‹¹ì‹ ì„ ê¸°ë‹¤ë¦¬ê³  ìˆë‹¤. ë‹¹ì‹ ì˜ ê²°ì •ê³¼ ì•½ê°„ì˜ í™•ë¥ ì´ ë§Œë“¤ì–´ë‚¼ í•˜ë£¨ëŠ” ì–´ë–¤ ëª¨ìŠµì¼ê¹Œ?"</p>
            <div id="nameInputArea">
                <label for="playerNameInput">ë‹¹ì‹ ì˜ ì´ë¦„ì€ ë¬´ì—‡ì…ë‹ˆê¹Œ?</label>
                <input type="text" id="playerNameInput" placeholder="ì—¬ê¸°ì— ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <div id="welcomeMessage" style="display:none;"></div>
            <div class="choices">
                <button id="submitNameButton" onclick="submitNameAndStart()">ì´ë¦„ ì…ë ¥í•˜ê³  í•˜ë£¨ ì‹œì‘í•˜ê¸°</button>
            </div>
        </div>

        <div id="stage1" class="stage">
            <h2>1ï¸âƒ£ ë‹¨ê³„: ì •ìˆ˜ê¸°ì˜ ë„ì „ ğŸ’§</h2>
            <div class="situation"><p>ëª©ì´ ë§ë¼ ì •ìˆ˜ê¸°ë¡œ í–¥í–ˆì§€ë§Œ, ì´ëŸ°! ë¬¼í†µì´ í…… ë¹„ì–´ìˆë‹¤. ë™ë£Œ/ì¹œêµ¬ë“¤ì€ ëª¨ë‘ ë°”ë¹  ë³´ì´ê³ , ì§€ê¸ˆ ë‹¹ì¥ ë¬¼ì„ ë§ˆì‹œë ¤ë©´ ë‚´ê°€ ì§ì ‘ ë¬¼í†µì„ êµì²´í•´ì•¼ í•  ê²ƒ ê°™ë‹¤.</p></div>
            <div class="dilemma"><p>"ì´ ë¬´ê±°ìš´ ë¬¼í†µ, ë‚´ê°€ ê³¼ì—° ì‚¬ê³  ì—†ì´ ì˜ ê°ˆ ìˆ˜ ìˆì„ê¹Œ? <span class='highlight-prob'>(ë„ì „ ì‹œ ì„±ê³µ í™•ë¥ : ì•½ 66.7%)</span> ê´œíˆ í˜ë§Œ ì“°ê³  ë§ì‹ ë‹¹í•˜ëŠ” ê±° ì•„ë‹ˆì•¼?"</p></div>
            <div class="choices">
                <button onclick="handleChoice(1, 'A', 'ë¬¼í†µ êµì²´ì— ë„ì „í•œë‹¤.')">A. ì¢‹ì•„, í•œë²ˆ í•´ë³´ì! ë‚´ê°€ í•´ê²°í•œë‹¤!</button>
                <button onclick="handleChoice(1, 'B', 'ë¬¼í†µ êµì²´ë¥¼ í¬ê¸°í•œë‹¤.')">B. ì•„ë‹ˆì•¼, ë„ˆë¬´ ë¬´ê±°ì›Œ ë³´ì—¬. ë‹¤ë¥¸ ì‚¬ëŒì„ ê¸°ë‹¤ë¦¬ì.</button>
            </div>
            <div class="outcome-area" id="outcomeArea1">
                <p class="probabilities"><strong>í™•ë¥  ì •ë³´:</strong> <span id="probs1"></span></p>
                <p class="actual-result"><strong>ì‹¤ì œ ê²°ê³¼:</strong> <span id="result1"></span></p>
            </div>
            <button class="next-button" id="nextButton1" onclick="proceedToNextStage(2)">ë‹¤ìŒìœ¼ë¡œ</button>
        </div>

        <div id="stage2" class="stage">
            <h2>2ï¸âƒ£ ë‹¨ê³„: ë™ì „ì˜ ì–‘ë©´, ë‚´ê¸°ì˜ ìœ í˜¹ ğŸ’°</h2>
            <div class="situation"><p>ì ì‹¬ì‹œê°„, ì¹œêµ¬ê°€ 100ì›ì„ ê±¸ê³  ì¬ë¯¸ìˆëŠ” ë‚´ê¸°ë¥¼ ì œì•ˆí•œë‹¤. "ë™ì „ 2ê°œë¥¼ ë™ì‹œì— ë˜ì§ˆ ê±°ì•¼. ê²°ê³¼ë¥¼ ì •í™•íˆ ë§íˆë©´ ë‚´ê°€ 200ì› ì¤„ê²Œ! ì–´ë•Œ, í•´ë³¼ë˜?" (ì°¸ê°€ë¹„ 100ì›)</p></div>
            <div class="dilemma"><p>"í , 100ì›ìœ¼ë¡œ 200ì›ì„ ë”¸ ê¸°íšŒì¸ê°€, ì•„ë‹ˆë©´ 100ì›ì„ ë‚ ë¦´ í•¨ì •ì¸ê°€... ì–´ë–¤ ê²½ìš°ê°€ ê°€ì¥ í™•ë¥ ì´ ë†’ì„ê¹Œ?"</p></div>
            <div class="choices">
                <button onclick="handleChoice(2, 'A', 'ì•ë©´ 2ê°œì— ê±´ë‹¤.')">A. ì¢‹ì•„! ë‚œ ì•ë©´ 2ê°œì— ê±´ë‹¤!</button>
                <button onclick="handleChoice(2, 'B', 'ì•ë©´ 1ê°œ, ë’·ë©´ 1ê°œì— ê±´ë‹¤.')">B. ë‚´ ë¶„ì„ìœ¼ë¡œëŠ” ì•ë©´ 1ê°œ, ë’·ë©´ 1ê°œê°€ ê°€ì¥ ìœ ë ¥í•´!</button>
                <button onclick="handleChoice(2, 'C', 'ë’·ë©´ 2ê°œì— ê±´ë‹¤.')">C. ì™ ì§€ ëŠë‚Œì´ ì•ˆ ì¢‹ì€ë°... ë‘˜ ë‹¤ ë’·ë©´ì´ ë‚˜ì˜¬ ê²ƒ ê°™ì•„!</button>
                <button onclick="handleChoice(2, 'D', 'ë‚´ê¸°ë¥¼ í•˜ì§€ ì•ŠëŠ”ë‹¤.')">D. ì•ˆ í• ë˜. ë‚´ ì†Œì¤‘í•œ 100ì›ì€ ì§€ì¼œì•¼ì§€.</button>
            </div>
            <div class="outcome-area" id="outcomeArea2">
                 <p class="probabilities"><strong>í™•ë¥  ì •ë³´:</strong> <span id="probs2"></span></p>
                 <p class="actual-result"><strong>ì‹¤ì œ ê²°ê³¼:</strong> <span id="result2"></span></p>
            </div>
            <button class="next-button" id="nextButton2" onclick="proceedToNextStage(3)">ë‹¤ìŒìœ¼ë¡œ</button>
        </div>

        <div id="stage3" class="stage">
            <h2>3ï¸âƒ£ ë‹¨ê³„: ë„ì„œê´€ì—ì„œì˜ ê¸°ëŒ€ê° ğŸ“š</h2>
            <div class="situation"><p>ì£¼ë§ ì˜¤í›„, ë„ì„œê´€ì— ê°€ì„œ ì±…ì„ ì½ì„ê¹Œ ê³ ë¯¼ ì¤‘ì´ë‹¤. ì–¼ë§ˆ ì „ ì¹œêµ¬ ìˆ˜ë¯¸ì™€ ì§€ì€ì´ë„ ì˜¤ëŠ˜ ë„ì„œê´€ì— ê°ˆ ìˆ˜ë„ ìˆë‹¤ê³  í–ˆë˜ ê¸°ì–µì´ ë‚œë‹¤. ë‘˜ ë‹¤ ë§Œë‚˜ë©´ ì •ë§ ì¢‹ì„ í…ë°!</p></div>
            <div class="dilemma"><p>"<span class='highlight-prob'>ìˆ˜ë¯¸ê°€ ë„ì„œê´€ì— ì˜¬ í™•ë¥ ì€ 1/3 (ì•½ 33.3%)</span>, <span class='highlight-prob'>ì§€ì€ì´ê°€ ì˜¬ í™•ë¥ ì€ 2/3 (ì•½ 66.7%)</span>ë¼ê³  í•œë‹¤. ë‘˜ ë‹¤ ë§Œë‚  í™•ë¥ ì€ ì–¼ë§ˆë‚˜ ë ê¹Œ? ì•„ë‹ˆë©´ ê·¸ëƒ¥ ì§‘ì—ì„œ í¸í•˜ê²Œ ì‰´ê¹Œ?"</p></div>
            <div class="choices">
                <button onclick="handleChoice(3, 'A', 'ë„ì„œê´€ì— ê°„ë‹¤.')">A. ì¢‹ì•„, ë„ì„œê´€ìœ¼ë¡œ ì¶œë°œ!</button>
                <button onclick="handleChoice(3, 'B', 'ë„ì„œê´€ì— ê°€ì§€ ì•Šê³  ì§‘ì—ì„œ ì‰°ë‹¤.')">B. ì˜¤ëŠ˜ì€ ê·¸ëƒ¥ ì§‘ì—ì„œ ì‰´ë˜.</button>
            </div>
            <div class="outcome-area" id="outcomeArea3">
                 <p class="probabilities"><strong>í™•ë¥  ì •ë³´:</strong> <span id="probs3"></span></p>
                 <p class="actual-result"><strong>ì‹¤ì œ ê²°ê³¼:</strong> <span id="result3"></span></p>
            </div>
            <button class="next-button" id="nextButton3" onclick="proceedToNextStage(4)">ë‹¤ìŒìœ¼ë¡œ</button>
        </div>

        <div id="stage4" class="stage">
            <h2>4ï¸âƒ£ ë‹¨ê³„: ë³€ë•ìŸì´ ë‚ ì”¨ì™€ ìš°ì‚° â˜”</h2>
            <div class="situation"><p>ì™¸ì¶œ ì¤€ë¹„ë¥¼ ê±°ì˜ ë§ˆì³¤ëŠ”ë°, ì°½ë°– í•˜ëŠ˜ì´ ì‹¬ìƒì¹˜ ì•Šë‹¤. ì¼ê¸°ì˜ˆë³´ë¥¼ í™•ì¸í•˜ë‹ˆ ì˜¤ëŠ˜ ë¹„ê°€ ì˜¬ í™•ë¥ ì€ <strong id="rainChanceDisplay" class="highlight-prob">XX%</strong>ë¼ê³  í•œë‹¤.</p></div>
            <div class="dilemma"><p>"ë¹„ ì˜¬ í™•ë¥ ì´ <span id="rainChanceDilemma" class="highlight-prob">XX</span>%ë¼ë‹ˆ... ì •ë§ ì• ë§¤í•œê±¸. ìš°ì‚°ì„ ì±™ê²¨ì•¼ í•˜ë‚˜, ë§ì•„ì•¼ í•˜ë‚˜?"</p></div>
            <div class="choices">
                <button onclick="handleChoice(4, 'A', 'ìš°ì‚°ì„ ê°€ì ¸ê°„ë‹¤.')">A. ê°€ì ¸ê°„ë‹¤.</button>
                <button onclick="handleChoice(4, 'B', 'ìš°ì‚°ì„ ì•ˆ ê°€ì ¸ê°„ë‹¤.')">B. ì•ˆ ê°€ì ¸ê°„ë‹¤.</button>
            </div>
            <div class="outcome-area" id="outcomeArea4">
                 <p class="probabilities"><strong>í™•ë¥  ì •ë³´:</strong> <span id="probs4"></span></p>
                 <p class="actual-result"><strong>ì‹¤ì œ ê²°ê³¼:</strong> <span id="result4"></span></p>
            </div>
            <button class="next-button" id="nextButton4" onclick="proceedToNextStage(5)">ë‹¤ìŒìœ¼ë¡œ</button>
        </div>

        <div id="stage5" class="stage">
            <h2>5ï¸âƒ£ ë‹¨ê³„: ìˆ˜ìƒí•œ ìíŒê¸°ì˜ ìœ í˜¹ âœ¨</h2>
            <div class="situation"><p>ì²˜ìŒ ë³´ëŠ” ë™ë„¤ë¥¼ ê±·ë‹¤ê°€ ë…íŠ¹í•œ ë””ìì¸ì˜ ìíŒê¸°ë¥¼ ë°œê²¬í–ˆë‹¤. 'ìˆ˜ìˆ˜ê»˜ë¼ì˜ ë§›!' ë²„íŠ¼ì´ ìˆê³ , ê°€ê²©ì€ 500ì›. ìíŒê¸°ì—ëŠ” "ì´ˆíŠ¹ê¸‰ ë ˆì–´í…œ ìŒë£Œ í™•ë¥  1/10! ê³ ê¸‰ ìŒë£Œ í™•ë¥  3/10! ì¼ë°˜ ìŒë£Œ í™•ë¥  6/10!" ì´ë¼ê³  ë°˜ì§ì´ë©° ì í˜€ìˆë‹¤.</p></div>
            <div class="dilemma"><p>"ì´ˆíŠ¹ê¸‰ ë ˆì–´í…œì´ë¼ë‹ˆ, ê¶ê¸ˆí•œë°? 500ì›ìœ¼ë¡œ ì¸ìƒ ìŒë£Œë¥¼ ë§Œë‚  ìˆ˜ë„ ìˆì–ì•„! í•˜ì§€ë§Œ ëŒ€ë¶€ë¶„ ì¼ë°˜ ìŒë£Œê°€ ë‚˜ì˜¤ê² ì§€?"</p></div>
            <div class="choices">
                <button onclick="handleChoice(5, 'A', 'ìˆ˜ìˆ˜ê»˜ë¼ ìŒë£Œì— ë„ì „í•œë‹¤.')">A. ì¸ìƒì€ í•œ ë°©! ìˆ˜ìˆ˜ê»˜ë¼ì˜ ë§›ì— ë„ì „í•œë‹¤!</button>
                <button onclick="handleChoice(5, 'B', 'ì•ˆì „í•˜ê²Œ ë‹¤ë¥¸ ìŒë£Œë¥¼ ì„ íƒí•˜ê±°ë‚˜ ì•ˆ ë§ˆì‹ ë‹¤.')">B. ì•„ë‹ˆì•¼, 500ì›ì´ë©´ í™•ì‹¤í•œ í–‰ë³µì„ ì‚´ ìˆ˜ ìˆì§€. ì˜†ì— ìˆëŠ” ìµìˆ™í•œ ì£¼ìŠ¤ë‚˜ ë§ˆì‹œì.</button>
            </div>
            <div class="outcome-area" id="outcomeArea5">
                 <p class="probabilities"><strong>í™•ë¥  ì •ë³´:</strong> <span id="probs5"></span></p>
                 <p class="actual-result"><strong>ì‹¤ì œ ê²°ê³¼:</strong> <span id="result5"></span></p>
            </div>
            <button class="next-button" id="nextButton5" onclick="proceedToNextStage(6)">ë‹¤ìŒìœ¼ë¡œ</button>
        </div>
        
        <div id="stage6" class="stage">
            <h2>6ï¸âƒ£ ë‹¨ê³„: ë¹µì§‘ì˜ ìœ í˜¹ ğŸ¥ğŸ</h2>
            <div class="situation"><p>í‡´ê·¼/í•˜êµê¸¸, ë™ë„¤ ë¹µì§‘ì— ë“¤ë¥¼ê¹Œ í•œë‹¤. ì¸ê¸° ë§ì€ ì´ˆì½”ë¹µê³¼ ì†Œê¸ˆë¹µì´ ì•„ì§ ë‚¨ì•„ìˆì„ê¹Œ? í•˜ë‚˜ë¼ë„ ë‚¨ì•„ìˆìœ¼ë©´ ì‚¬ì„œ ê°€ê³  ì‹¶ì€ë°...</p></div>
            <div class="dilemma"><p>"<span class='highlight-prob'>ì´ˆì½”ë¹µì´ ì´ë¯¸ ë‹¤ íŒ”ë ¸ì„ í™•ë¥ ì€ 1/4 (25%)</span>, <span class='highlight-prob'>ì†Œê¸ˆë¹µì´ ì´ë¯¸ ë‹¤ íŒ”ë ¸ì„ í™•ë¥ ì€ 2/3 (ì•½ 66.7%)</span>ë¼ê³  í•œë‹¤. ë‘˜ ë‹¤ ì´ë¯¸ íŒ”ë ¸ìœ¼ë©´ ì–´ë–¡í•˜ì§€? í•˜ë‚˜ë¼ë„ ë‚¨ì•„ìˆìœ¼ë©´ ì¢‹ê² ëŠ”ë°..."</p></div>
            <div class="choices">
                <button onclick="handleChoice(6, 'A', 'ë¹µì§‘ì— ê°€ë³¸ë‹¤.')">A. ê·¸ë˜ë„ ê°€ë³´ì! ë¹µì´ ë‚¨ì•„ìˆì„ì§€ë„ ëª°ë¼.</button>
                <button onclick="handleChoice(6, 'B', 'ë¹µì§‘ì— ê°€ì§€ ì•ŠëŠ”ë‹¤.')">B. ì´ë¯¸ ë‹¤ íŒ”ë ¸ì„ ê²ƒ ê°™ì•„. ê·¸ëƒ¥ ì§‘ì— ê°€ì.</button>
            </div>
            <div class="outcome-area" id="outcomeArea6">
                 <p class="probabilities"><strong>í™•ë¥  ì •ë³´:</strong> <span id="probs6"></span></p>
                 <p class="actual-result"><strong>ì‹¤ì œ ê²°ê³¼:</strong> <span id="result6"></span></p>
            </div>
            <button class="next-button" id="nextButton6" onclick="proceedToNextStage(7)">ë‹¤ìŒìœ¼ë¡œ (ê²°ê³¼ ë³´ê¸°)</button>
        </div>

        <div id="summaryStage" class="stage">
            <h2 id="summaryTitle">ğŸ“œ ë‚˜ì˜ í•˜ë£¨ ì´ì•¼ê¸° ğŸ“œ</h2>
            <div id="summaryContainer">
                <h3>âœ¨ ë‚´ê°€ ê²½í—˜í•œ í•˜ë£¨ì˜ ìˆœê°„ë“¤ âœ¨</h3>
                <ul id="recapList"></ul>
                <hr>
                <h3 id="finalVerdict"></h3>
            </div>
            <div class="choices">
                <button onclick="restartGame()">ë‹¤ì‹œ í•˜ë£¨ë¥¼ ì‹œì‘í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        let playerName = "ëª¨í—˜ê°€"; 
        let currentStageNumInternal = 0;
        const storyLog = [];
        let rainPercentage = 0; 

        const probChocoSoldOut = 1/4;
        const probSaltSoldOut = 2/3;

        const typingSpeed = 30; // ê¸€ì íƒ€ì´í•‘ ì†ë„ (ms)

        function typewriter(elementId, text, callback) {
            const element = document.getElementById(elementId);
            if (!element) {
                if (callback) callback();
                return;
            }
            element.innerHTML = ""; // ê¸°ì¡´ í…ìŠ¤íŠ¸ í´ë¦¬ì–´
            let i = 0;
            function type() {
                if (i < text.length) {
                    element.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(type, typingSpeed);
                } else {
                    if (callback) callback();
                }
            }
            type();
        }

        function triggerScreenShake() {
            const container = document.querySelector('.container');
            container.classList.add('screen-shake');
            setTimeout(() => {
                container.classList.remove('screen-shake');
            }, 400); // ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„ê³¼ ì¼ì¹˜
        }


        function showStage(stageIdToShow) {
            document.querySelectorAll('.stage').forEach(stage => {
                stage.style.display = 'none';
            });
            const stageElement = document.getElementById(stageIdToShow);
            if (stageElement) {
                stageElement.style.display = 'block';
            }

            const stageNum = parseInt(stageIdToShow.replace('stage', ''));
            if (stageNum >=1 && stageNum <=6) { 
                const outcomeArea = document.getElementById('outcomeArea' + stageNum);
                if (outcomeArea) outcomeArea.style.display = 'none';
                
                const resultSpan = document.getElementById('result' + stageNum);
                if(resultSpan) {
                    resultSpan.innerHTML = ''; // ì´ì „ ê²°ê³¼ í…ìŠ¤íŠ¸ í´ë¦¬ì–´
                    resultSpan.className = ''; // ì´ì „ ìŠ¤íƒ€ì¼ í´ë˜ìŠ¤ í´ë¦¬ì–´
                }


                const nextButton = document.getElementById('nextButton' + stageNum);
                if (nextButton) nextButton.style.display = 'none'; 

                const choiceDiv = stageElement.querySelector('.choices');
                if (choiceDiv) {
                    choiceDiv.querySelectorAll('button').forEach(button => {
                         button.style.display = 'block'; 
                         button.disabled = false;
                    });
                }
            }
        }
        
        function submitNameAndStart() {
            const nameInput = document.getElementById('playerNameInput');
            const welcomeDiv = document.getElementById('welcomeMessage');
            const nameInputAreaDiv = document.getElementById('nameInputArea');
            const submitBtn = document.getElementById('submitNameButton');
            
            if (nameInput.value.trim() !== "") {
                playerName = nameInput.value.trim();
            } else {
                playerName = "ëª¨í—˜ê°€"; 
            }

            if (nameInputAreaDiv) nameInputAreaDiv.style.display = 'none'; 
            if (submitBtn) submitBtn.style.display = 'none'; 

            welcomeDiv.style.display = 'block';
            typewriter('welcomeMessage', `${playerName}ë‹˜, ì¢‹ì€ ì´ë¦„ì´êµ°ìš”! ë‹¹ì‹ ì˜ ì„ íƒìœ¼ë¡œ ë©‹ì§„ í•˜ë£¨ë¥¼ ë§Œë“¤ì–´ ë³´ì„¸ìš”!`, () => {
                setTimeout(() => {
                    startGameLogic(); 
                }, 1000); // í™˜ì˜ ë©”ì‹œì§€ í‘œì‹œ í›„ 1ì´ˆ ë’¤ ê²Œì„ ì‹œì‘
            });
        }


        function startGameLogic() { 
            currentStageNumInternal = 1;
            storyLog.length = 0; 
            
            const welcomeDiv = document.getElementById('welcomeMessage');
            const nameInputAreaDiv = document.getElementById('nameInputArea');
            const nameInput = document.getElementById('playerNameInput');
            const submitBtn = document.getElementById('submitNameButton');

            if (welcomeDiv) welcomeDiv.style.display = 'none';
            if (nameInputAreaDiv) nameInputAreaDiv.style.display = 'block';
            if (nameInput) nameInput.value = '';
            if (submitBtn) submitBtn.style.display = 'block';

            rainPercentage = Math.floor(Math.random() * 61) + 20; 
            document.getElementById('rainChanceDisplay').textContent = rainPercentage + "%";
            document.getElementById('rainChanceDilemma').textContent = rainPercentage; 
            
            document.getElementById('summaryTitle').textContent = `ğŸ“œ ${playerName}ë‹˜ì˜ í•˜ë£¨ ì´ì•¼ê¸° ğŸ“œ`;
            
            showStage('stage' + currentStageNumInternal);
        }
        
        function restartGame() {
            const nameInputAreaDiv = document.getElementById('nameInputArea');
            const nameInput = document.getElementById('playerNameInput');
            const welcomeDiv = document.getElementById('welcomeMessage');
            const submitBtn = document.getElementById('submitNameButton');

            if (nameInputAreaDiv) nameInputAreaDiv.style.display = 'block';
            if (nameInput) nameInput.value = ''; 
            if (welcomeDiv) welcomeDiv.style.display = 'none';
            if (submitBtn) submitBtn.style.display = 'block';

            showStage('stage0');
        }

        function addLog(stageTitle, choiceMade, probabilitiesShown, actualOutcome) {
            storyLog.push({ 
                stage: stageTitle, 
                choice: choiceMade, 
                probabilities: probabilitiesShown,
                outcome: actualOutcome 
            });
        }

        function handleChoice(stageNum, choiceKey, choiceText) {
            currentStageNumInternal = stageNum;
            let probabilitiesText = ""; 
            let outcomeText = ""; 
            let outcomeSentiment = 'neutral'; // 'good', 'bad', 'neutral'
            const stageTitle = document.getElementById('stage' + stageNum).querySelector('h2').textContent;

            switch (stageNum) {
                case 1: 
                    if (choiceKey === 'B') { 
                        probabilitiesText = "ë„ì „í•˜ì§€ ì•Šê¸°ë¡œ ì„ íƒí•¨. (ë§Œì•½ ë„ì „í–ˆë‹¤ë©´ ì„±ê³µ í™•ë¥  ì•½ 66.7%)";
                        outcomeText = "ë¬¼í†µ êµì²´ë¥¼ í¬ê¸°í–ˆë‹¤. ê²°êµ­ ë‹¤ë¥¸ ì‚¬ëŒì´ êµì²´í•´ì£¼ê±°ë‚˜, ëª©ë§ˆë¦„ì„ ì°¸ì•„ì•¼ í–ˆë‹¤.";
                        outcomeSentiment = 'neutral';
                    } else { 
                        probabilitiesText = "ë„ì „ ì‹œ ì„±ê³µ í™•ë¥ : 2/3 (ì•½ 66.7%), ì‹¤íŒ¨ í™•ë¥ : 1/3 (ì•½ 33.3%)";
                        if (Math.random() < (2/3)) { 
                            outcomeText = "ì™„ë²½í•´! ë¬¼í†µì„ ëŠ¥ìˆ™í•˜ê²Œ êµì²´í–ˆë‹¤. ë™ë£Œ/ì¹œêµ¬ë“¤ì˜ ê°íƒ„ê³¼ ì„ ë§ì˜ ì‹œì„ ì„ í•œ ëª¸ì— ë°›ì•˜ë‹¤. ì—­ì‹œ ë‚œ ëª»í•˜ëŠ” ê²Œ ì—†ì§€!";
                            outcomeSentiment = 'good';
                        } else {
                            outcomeText = "ì´ëŸ°! ë¬¼í†µì„ ë“¤ë‹¤ê°€ ê·¸ë§Œ ì†ì´ ë¯¸ë„ëŸ¬ì ¸ ë¬¼ì„ ìŸê³  ë§ì•˜ë‹¤. ì˜·ë„ ì –ê³  ë°”ë‹¥ë„ ë¬¼ë°”ë‹¤ê°€ ë˜ì–´ ë‹¹í™©ìŠ¤ëŸ½ë‹¤. ê´œíˆ ë‚˜ì„°ë‚˜...";
                            outcomeSentiment = 'bad';
                        }
                    }
                    break;
                case 2: 
                    let coin1 = Math.random() < 0.5 ? 'ì•' : 'ë’¤';
                    let coin2 = Math.random() < 0.5 ? 'ì•' : 'ë’¤';
                    let actualCoinResult = "";
                    if (coin1 === 'ì•' && coin2 === 'ì•') actualCoinResult = 'AA';
                    else if (coin1 === 'ë’¤' && coin2 === 'ë’¤') actualCoinResult = 'TT';
                    else actualCoinResult = 'AT'; 

                    if (choiceKey === 'D') {
                        probabilitiesText = "ë‚´ê¸°ë¥¼ í•˜ì§€ ì•Šì•„ ëˆì˜ ë³€í™”ëŠ” ì—†ìŒ.";
                        const actualResultText = (actualCoinResult === 'AA' ? 'ì•ë©´ 2ê°œ' : (actualCoinResult === 'TT' ? 'ë’·ë©´ 2ê°œ' : 'ì•ë©´ 1ê°œ, ë’·ë©´ 1ê°œ'));
                        outcomeText = `ë‚´ê¸°ë¥¼ í•˜ì§€ ì•Šê¸°ë¡œ í–ˆë‹¤. 100ì›ì„ ì•„ê¼ˆìœ¼ë‹ˆ ì†í•´ëŠ” ì•„ë‹ˆì§€ë§Œ, ê²°ê³¼ëŠ” ê¶ê¸ˆí•˜ë„¤! (ì‹¤ì œ ë™ì „ ê²°ê³¼: ${actualResultText})`;
                        outcomeSentiment = 'neutral';
                    } else {
                        let predictedResultKey = "";
                        if (choiceKey === 'A') {
                            probabilitiesText = "ë‚˜ì˜ ì„ íƒ: ì•ë©´ 2ê°œ. (ì´ ê²°ê³¼ê°€ ë‚˜ì˜¬ í™•ë¥ : 1/4 = 25%)";
                            predictedResultKey = 'AA';
                        } else if (choiceKey === 'B') {
                            probabilitiesText = "ë‚˜ì˜ ì„ íƒ: ì•ë©´ 1ê°œ, ë’·ë©´ 1ê°œ. (ì´ ê²°ê³¼ê°€ ë‚˜ì˜¬ í™•ë¥ : 2/4 = 50%)";
                            predictedResultKey = 'AT';
                        } else { 
                            probabilitiesText = "ë‚˜ì˜ ì„ íƒ: ë’·ë©´ 2ê°œ. (ì´ ê²°ê³¼ê°€ ë‚˜ì˜¬ í™•ë¥ : 1/4 = 25%)";
                            predictedResultKey = 'TT';
                        }

                        if (actualCoinResult === predictedResultKey) {
                            outcomeText = "ëŒ€ë°•! ì •í™•íˆ ë§í˜”ë‹¤! ì¹œêµ¬ì—ê²Œ 200ì›ì„ ë°›ì•„ 100ì› ì´ë“ì„ ë´¤ë‹¤. ì—­ì‹œ ë‚œ ì˜ˆì¸¡ì˜ ì‹ ì´ì•¼!";
                            outcomeSentiment = 'good';
                        } else {
                            const actualResultText = (actualCoinResult === 'AA' ? 'ì•ë©´ 2ê°œ' : (actualCoinResult === 'TT' ? 'ë’·ë©´ 2ê°œ' : 'ì•ë©´ 1ê°œ, ë’·ë©´ 1ê°œ'));
                            outcomeText = `ì•„ì‰½ë„¤, ì˜ˆì¸¡ ì‹¤íŒ¨! ì°¸ê°€ë¹„ 100ì›ë§Œ ë‚ ë ¸ë‹¤. (ì‹¤ì œ ë™ì „ ê²°ê³¼: ${actualResultText})`;
                            outcomeSentiment = 'bad';
                        }
                    }
                    break;
                case 3: 
                    const probSumiYes = 1/3; const probSumiNo = 2/3;
                    const probJieunYes = 2/3; const probJieunNo = 1/3;
                    const probBoth = (probSumiYes * probJieunYes); 
                    const probSumiOnly = (probSumiYes * probJieunNo);
                    const probJieunOnly = (probSumiNo * probJieunYes); 
                    const probNeither = (probSumiNo * probJieunNo); 
                    
                    if (choiceKey === 'B') { 
                        probabilitiesText = `ë„ì„œê´€ì— ê°€ì§€ ì•Šê¸°ë¡œ ì„ íƒí•¨. (ì°¸ê³ : ìˆ˜ë¯¸ë§Œ ì˜¬ í™•ë¥  ì•½ ${Math.round(probSumiOnly*100)}%, ì§€ì€ì´ë§Œ ì˜¬ í™•ë¥  ì•½ ${Math.round(probJieunOnly*100)}%, ë‘˜ ë‹¤ ì˜¬ í™•ë¥  ì•½ ${Math.round(probBoth*100)}%)`;
                        outcomeText = "ì§‘ì—ì„œ í¸ì•ˆí•˜ê²Œ íœ´ì‹ì„ ì·¨í–ˆë‹¤. ë„ì„œê´€ì— ê°”ìœ¼ë©´ ëˆ„êµ¬ë¥¼ ë§Œë‚¬ì„ì§€ëŠ” ë¯¸ìŠ¤í„°ë¦¬ë¡œ ë‚¨ì•˜ë‹¤. ê°€ë”ì€ ì´ëŸ° ì—¬ìœ ë„ ì¢‹ì§€!";
                        outcomeSentiment = 'neutral';
                    } else { 
                        let sumiComes = Math.random() < probSumiYes;
                        let jieunComes = Math.random() < probJieunYes;
                        probabilitiesText = `ì„ íƒ: ë„ì„œê´€ì— ê°„ë‹¤. (ìˆ˜ë¯¸ ì˜¬ í™•ë¥ : 1/3, ì§€ì€ì´ ì˜¬ í™•ë¥ : 2/3). <br>ìƒì„¸ ê²°ê³¼ í™•ë¥ : ë‘˜ ë‹¤ ë§Œë‚¨(${Math.round(probBoth*100)}%), ìˆ˜ë¯¸ë§Œ(${Math.round(probSumiOnly*100)}%), ì§€ì€ì´ë§Œ(${Math.round(probJieunOnly*100)}%), ì•„ë¬´ë„ ëª» ë§Œë‚¨(${Math.round(probNeither*100)}%)`;
                        
                        if (sumiComes && jieunComes) {
                            outcomeText = "ëŒ€ì„±ê³µ! ë„ì„œê´€ì— ê°”ë”ë‹ˆ ìˆ˜ë¯¸ì™€ ì§€ì€ì´ ë‘˜ ë‹¤ ì™€ ìˆì—ˆë‹¤! í•¨ê»˜ ê³µë¶€í•˜ê³  ì´ì•¼ê¸°ë„ ë‚˜ëˆ„ë©° ì¦ê±°ìš´ ì‹œê°„ì„ ë³´ëƒˆë‹¤.";
                            outcomeSentiment = 'good';
                        } else if (sumiComes && !jieunComes) {
                            outcomeText = "ë„ì„œê´€ì—ì„œ ìˆ˜ë¯¸ë¥¼ ë§Œë‚¬ë‹¤! ì§€ì€ì´ëŠ” ì•ˆ ì™”ì§€ë§Œ, ìˆ˜ë¯¸ì™€ ì˜¤ëœë§Œì— ì´ëŸ°ì €ëŸ° ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ´ë‹¤.";
                            outcomeSentiment = 'good';
                        } else if (!sumiComes && jieunComes) {
                            outcomeText = "ë„ì„œê´€ì— ê°”ë”ë‹ˆ ì§€ì€ì´ê°€ ì™€ ìˆì—ˆë‹¤! ìˆ˜ë¯¸ëŠ” ëª» ë´¤ì§€ë§Œ, ì§€ì€ì´ì™€ í•¨ê»˜ ì§‘ì¤‘í•´ì„œ ê³µë¶€í–ˆë‹¤.";
                            outcomeSentiment = 'good';
                        } else {
                            outcomeText = "ì•„ë¬´ë„ ì—†ë„¤... ê²°êµ­ ë„ì„œê´€ì—ì„œ í˜¼ì ê³µë¶€í•˜ë‹¤ ì™”ë‹¤. ê·¸ë˜ë„ ì¡°ìš©í•´ì„œ ì§‘ì¤‘ì€ ì˜ ëœ ê²ƒ ê°™ë‹¤.";
                            outcomeSentiment = 'neutral';
                        }
                    }
                    break;
                case 4: 
                    let itRains = Math.random() < (rainPercentage / 100);
                    probabilitiesText = `ì˜¤ëŠ˜ ë¹„ ì˜¬ ì‹¤ì œ í™•ë¥ : ${rainPercentage}%.`;
                    if (choiceKey === 'A') { 
                        if (itRains) {
                            outcomeText = "ì—­ì‹œ ë‚´ íŒë‹¨ì´ ì˜³ì•˜ì–´! ìš°ì‚°ì„ ì±™ê²¨ì„œ ë¹„ë¥¼ í”¼í•  ìˆ˜ ìˆì—ˆë‹¤. ì¤€ë¹„ëœ ìì˜ ì—¬ìœ !";
                            outcomeSentiment = 'good';
                        } else {
                            outcomeText = "ê²°êµ­ ë¹„ëŠ” ì˜¤ì§€ ì•Šì•˜ë‹¤. ê·¸ëŸ°ë° ì´ëŸ°, ìš°ì‚°ì„ ì–´ë””ë‹¤ ë‘ê³  ì˜¨ ê±°ì§€? ê¹œë¹¡í•˜ê³  ì‹ë‹¹/ì¹´í˜ì— ë†“ê³  ì™€ì„œ ìƒì–´ë²„ë ¸ë‹¤. ê´œíˆ ë“¤ê³  ë‚˜ì™”ë‚˜...";
                            outcomeSentiment = 'bad';
                        }
                    } else { 
                        if (itRains) {
                            outcomeText = "ì´ëŸ´ ìˆ˜ê°€! ê°‘ìê¸° ìŸì•„ì§€ëŠ” ë¹„ì— ì«„ë”± ë§ì•˜ë‹¤. ì¤‘ìš”í•œ ì•½ì†ì¸ë° ìŠ¤íƒ€ì¼ ë‹¤ êµ¬ê²¼ë„¤. ê°ê¸° ê±¸ë¦´ ê²ƒ ê°™ì•„.";
                            outcomeSentiment = 'bad';
                        } else {
                            outcomeText = "ì—­ì‹œ ë‚˜ì˜ ì„ íƒ! ë¹„ë„ ì•ˆ ì˜¤ê³  ê°€ë³ê²Œ ì™¸ì¶œí•´ì„œ ì •ë§ í¸í–ˆë‹¤. ìš´ì´ ì¢‹ì•˜ì–´!";
                            outcomeSentiment = 'good';
                        }
                    }
                    break;
                case 5: 
                     if (choiceKey === 'B') {
                        probabilitiesText = "ì•ˆì „í•œ ì„ íƒì„ í•¨. (ìˆ˜ìˆ˜ê»˜ë¼ ìŒë£ŒëŠ” ë ˆì–´í…œ 10%, ê³ ê¸‰ 30%, ì¼ë°˜ 60% í™•ë¥ )";
                        outcomeText = "ìˆ˜ìˆ˜ê»˜ë¼ ìíŒê¸°ëŠ” ê·¸ëƒ¥ ì§€ë‚˜ì³¤ë‹¤. ì–´ë–¤ ìŒë£Œê°€ ë‚˜ì™”ì„ì§€ëŠ” ëª¨ë¥´ê² ì§€ë§Œ, ë‚´ ëˆ 500ì›ì€ ì•ˆì „í•˜ê²Œ ì§€ì¼°ë‹¤. / ì˜†ì— ìˆëŠ” ì½œë¼ë¥¼ ë§ˆì…¨ë‹¤. ìµìˆ™í•œ ë§›ì´ ì—­ì‹œ ìµœê³ ë‹¤!";
                        outcomeSentiment = 'neutral';
                    } else { 
                        probabilitiesText = "ì„ íƒ: ìˆ˜ìˆ˜ê»˜ë¼ ìŒë£Œ! (ì´ˆíŠ¹ê¸‰ ë ˆì–´í…œ í™•ë¥ : 10%, ê³ ê¸‰ ìŒë£Œ í™•ë¥ : 30%, ì¼ë°˜ ìŒë£Œ í™•ë¥ : 60%)";
                        let rand = Math.random();
                        if (rand < 0.1) { 
                            outcomeText = "ëŒ€ë°•! ìíŒê¸°ì—ì„œ ì •ë§ í¬ê·€í•˜ê³  ë§›ìˆëŠ” 'ì´ˆíŠ¹ê¸‰ ë ˆì–´í…œ ìŒë£Œ'ê°€ ë‚˜ì™”ë‹¤! ì˜¤ëŠ˜ ë­”ê°€ ì¢‹ì€ ì¼ì´ ìƒê¸¸ ê²ƒ ê°™ì€ ì˜ˆê°ì´ ë“ ë‹¤. 500ì›ì˜ í–‰ë³µì´ ì´ëŸ° ê±´ê°€!";
                            outcomeSentiment = 'good';
                        } else if (rand < 0.1 + 0.3) { 
                            outcomeText = "ì˜¤! 'ê³ ê¸‰ ê³¼ì¼ ìŠ¤ë¬´ë””'ê°€ ë‚˜ì™”ë‹¤! ìƒê°ë³´ë‹¤ í›¨ì”¬ ê´œì°®ì€ë°? 500ì›ì´ ì•„ê¹ì§€ ì•Šì•„!";
                            outcomeSentiment = 'good';
                        } else { 
                            outcomeText = "ìŒ... ê·¸ëƒ¥ í‰ë²”í•œ ì˜¤ë Œì§€ ì£¼ìŠ¤ê°€ ë‚˜ì™”ë„¤. ë§›ì€ ìˆì§€ë§Œ, 'ìˆ˜ìˆ˜ê»˜ë¼'ëŠ” ì•„ë‹ˆì—ˆë‹¤. 500ì›ì´ ì¡°ê¸ˆ ì•„ê¹ê¸°ë„ í•˜ê³ .";
                            outcomeSentiment = 'neutral';
                        }
                    }
                    break;
                case 6: 
                    const probChocoNotSold = 1 - probChocoSoldOut; 
                    const probSaltNotSold = 1 - probSaltSoldOut;   
                    const probBothAvailable = (probChocoNotSold * probSaltNotSold); 
                    const probChocoOnlyAvailable = (probChocoNotSold * probSaltSoldOut);     
                    const probSaltOnlyAvailable = (probChocoSoldOut * probSaltNotSold);       
                    const probNeitherAvailable = (probChocoSoldOut * probSaltSoldOut); 
                                    
                    if (choiceKey === 'B') { 
                        probabilitiesText = `ë¹µì§‘ì— ê°€ì§€ ì•Šê¸°ë¡œ ê²°ì •. (ì°¸ê³ : ë‘˜ ë‹¤ ë‚¨ì•„ìˆì„ í™•ë¥  ì•½ ${Math.round(probBothAvailable*100)}%, í•˜ë‚˜ë¼ë„ ë‚¨ì•„ìˆì„ í™•ë¥  ì•½ ${Math.round((1-probNeitherAvailable)*100)}%)`;
                        outcomeText = "ë¹µì§‘ì— ê°€ì§€ ì•Šì•˜ìœ¼ë‹ˆ ë¹µì„ ì‚´ ê¸°íšŒëŠ” ì—†ì—ˆë‹¤. ì§‘ì— ì™€ì„œ ë‹¤ë¥¸ ê°„ì‹ì„ ì°¾ì•„ë´ì•¼ê² ë‹¤. (ë¹µì§‘ì— ê°”ë‹¤ë©´ ì–´ë–¤ ê²°ê³¼ì˜€ì„ê¹Œ?)";
                        outcomeSentiment = 'neutral';
                    } else { 
                        let chocobreadAvailable = Math.random() < probChocoNotSold;
                        let saltbreadAvailable = Math.random() < probSaltNotSold;
                        
                        probabilitiesText = `ì„ íƒ: ë¹µì§‘ì— ê°„ë‹¤. (ì´ˆì½”ë¹µ ë‚¨ì•„ìˆì„ í™•ë¥ : ${Math.round(probChocoNotSold*100)}%, ì†Œê¸ˆë¹µ ë‚¨ì•„ìˆì„ í™•ë¥ : ${Math.round(probSaltNotSold*100)}%).<br> ìƒì„¸: ë‘˜ë‹¤O(${Math.round(probBothAvailable*100)}%), ì´ˆì½”ë§ŒO(${Math.round(probChocoOnlyAvailable*100)}%), ì†Œê¸ˆë§ŒO(${Math.round(probSaltOnlyAvailable*100)}%), ë‘˜ë‹¤X(${Math.round(probNeitherAvailable*100)}%)`;

                        if (chocobreadAvailable && saltbreadAvailable) {
                            outcomeText = "ëŒ€ì„±ê³µ! ì´ˆì½”ë¹µê³¼ ì†Œê¸ˆë¹µ ë‘˜ ë‹¤ ë‚¨ì•„ìˆì—ˆë‹¤! í–‰ë³µí•œ ê³ ë¯¼ ëì— ë‘˜ ë‹¤ ì‚¬ë²„ë ¸ë‹¤.";
                            outcomeSentiment = 'good';
                        } else if (chocobreadAvailable && !saltbreadAvailable) {
                            outcomeText = "ë‹¤í–‰ì´ë‹¤! ì´ˆì½”ë¹µì€ ë‚¨ì•„ìˆì—ˆë‹¤. ì†Œê¸ˆë¹µì€ ì´ë¯¸ ë‹¤ íŒ”ë ¸ì§€ë§Œ, ì´ˆì½”ë¹µì´ë¼ë„ ì‚´ ìˆ˜ ìˆì–´ì„œ ê¸°ì˜ë‹¤.";
                            outcomeSentiment = 'good';
                        } else if (!chocobreadAvailable && saltbreadAvailable) {
                            outcomeText = "ì˜¤! ì†Œê¸ˆë¹µì´ ê¸°ì ì ìœ¼ë¡œ ë‚¨ì•„ìˆì—ˆë‹¤! ì´ˆì½”ë¹µì€ ì—†ì—ˆì§€ë§Œ, ì´ê²ƒë§Œìœ¼ë¡œë„ ë§Œì¡±ìŠ¤ëŸ½ë‹¤.";
                            outcomeSentiment = 'good';
                        } else { 
                            outcomeText = "ì´ëŸ°... ì—­ì‹œ ëŠ¦ì—ˆë‚˜ ë³´ë‹¤. ì´ˆì½”ë¹µë„ ì†Œê¸ˆë¹µë„ ëª¨ë‘ ë‹¤ íŒ”ë¦¬ê³  ì—†ì—ˆë‹¤. ë¹ˆì†ìœ¼ë¡œ ëŒì•„ê°€ì•¼ í•˜ë‹¤ë‹ˆ...";
                            outcomeSentiment = 'bad';
                        }
                    }
                    break;
            }
            
            addLog(stageTitle, choiceText, probabilitiesText, outcomeText);

            // ì„ íƒ ë²„íŠ¼ ë¹„í™œì„±í™”/ìˆ¨ê¸°ê¸°
            const choiceButtonsContainer = document.querySelector(`#stage${stageNum} .choices`);
            choiceButtonsContainer.querySelectorAll('button').forEach(button => {
                button.disabled = true; // ë¹„í™œì„±í™”
                button.style.opacity = "0.5"; // ë¹„í™œì„±í™”ëœ ê²ƒì²˜ëŸ¼ ë³´ì´ê²Œ
                // button.style.display = 'none'; // ì•„ì˜ˆ ìˆ¨ê¸°ë ¤ë©´
            });
            
            // í™•ë¥  ì •ë³´ ì¦‰ì‹œ í‘œì‹œ
            document.getElementById('probs' + stageNum).innerHTML = probabilitiesText;
            const resultSpan = document.getElementById('result' + stageNum);
            resultSpan.className = ''; // ê¸°ì¡´ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
            resultSpan.classList.add('outcome-text-' + outcomeSentiment);


            // ê²°ê³¼ í…ìŠ¤íŠ¸ íƒ€ì´í•‘ íš¨ê³¼ ë° ë‹¤ìŒ ë²„íŠ¼ í‘œì‹œ
            document.getElementById('outcomeArea' + stageNum).style.display = 'block';
            typewriter('result' + stageNum, outcomeText, () => {
                 document.getElementById('nextButton' + stageNum).style.display = 'block';
                 if (outcomeSentiment === 'bad') {
                    triggerScreenShake();
                }
            });
        }

        function proceedToNextStage(nextStageNum) {
            if (nextStageNum <= 6) { 
                currentStageNumInternal = nextStageNum; 
                showStage('stage' + nextStageNum);
            } else {
                showSummary();
            }
        }

        function showSummary() {
            const recapListEl = document.getElementById('recapList');
            recapListEl.innerHTML = ""; 

            let overallFeeling = "ì˜¤ëŠ˜ì€ ì •ë§ ë‹¤ì´ë‚˜ë¯¹í•œ í•˜ë£¨ì˜€ë‹¤!"; 

            storyLog.forEach(log => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `<strong>${log.stage}</strong><br>
                                      <span style="color:#555;">ë‚˜ì˜ ì„ íƒ: ${log.choice}</span><br>
                                      <em>(ë‹¹ì‹œ ì œì‹œëœ í™•ë¥  ì •ë³´: ${log.probabilities})</em><br>
                                      <span style="color: #1c1e21;">ì‹¤ì œ ê²°ê³¼: ${log.outcome}</span>`; // ê²°ê³¼ ìƒ‰ìƒ ê¸°ë³¸ìœ¼ë¡œ
                recapListEl.appendChild(listItem);
            });
            
            let goodOutcomes = 0;
            storyLog.forEach(log => {
                if (log.outcome.includes("ì„±ê³µ") || log.outcome.includes("ì´ë“") || log.outcome.includes("ë§Œë‚¬ë‹¤") || log.outcome.includes("í”¼í•  ìˆ˜ ìˆì—ˆë‹¤") || log.outcome.includes("í¸í–ˆë‹¤") || log.outcome.includes("ë ˆì–´í…œ") || log.outcome.includes("ê³ ê¸‰") || log.outcome.includes("ë‚¨ì•„ìˆì—ˆë‹¤") || log.outcome.includes("ê±´ì¡Œë„¤") || log.outcome.includes("ì •í™•íˆ ë§í˜”ë‹¤") || log.outcome.includes("ì„ ë§ì˜ ì‹œì„ ") || log.outcome.includes("ê¸°ë¶„ ì¢‹ì€")) {
                    goodOutcomes++;
                }
            });

            if (storyLog.length > 0) { 
                if (goodOutcomes >= storyLog.length * 0.6) { 
                    overallFeeling = `ì˜¤ëŠ˜ì€ ${playerName}ë‹˜ì—ê²Œ ìš´ì´ ê½¤ ë”°ëë˜ ë©‹ì§„ í•˜ë£¨ì˜€ë‹¤! ì„ íƒë“¤ì´ ëŒ€ë¶€ë¶„ ì¢‹ì€ ê²°ê³¼ë¡œ ì´ì–´ì¡Œë„¤!`;
                } else if (goodOutcomes <= storyLog.length * 0.3) { 
                    overallFeeling = `ì˜¤ëŠ˜ì€ ${playerName}ë‹˜ì—ê²Œ ì¡°ê¸ˆ ì•„ì‰¬ìš´ ì„ íƒì´ ë§ì•˜ë˜ ê²ƒ ê°™ë‹¤. í•˜ì§€ë§Œ ëª¨ë“  ê²½í—˜ì—ì„œ ë°°ìš°ëŠ” ê±°ë‹ˆê¹Œ! ë‹¤ìŒì—” ë” ì¢‹ì€ ê²°ê³¼ê°€ ìˆê¸°ë¥¼!`;
                } else {
                    overallFeeling = `ì˜¤ëŠ˜ì€ ${playerName}ë‹˜ì—ê²Œ ê¸°ë¶„ ì¢‹ì€ ì¼ë„, ì•„ì‰¬ìš´ ì¼ë„ ìˆì—ˆë˜ í‰ë²”í•˜ì§€ë§Œ íŠ¹ë³„í•œ í•˜ë£¨ì˜€ë‹¤. ë‚´ì¼ì€ ë˜ ì–´ë–¤ ì¼ë“¤ì´ í¼ì³ì§ˆê¹Œ?`;
                }
            }

            document.getElementById('finalVerdict').textContent = "ì´í‰: " + overallFeeling;
            showStage('summaryStage');
        }

        // ì´ˆê¸° í™”ë©´ í‘œì‹œ
        showStage('stage0');
    </script>
</body>
</html>